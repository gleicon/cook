{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Cook","text":"<p>Configuration management in Python for the Impatient.</p>"},{"location":"#overview","title":"Overview","text":"<p>Cook is a Python-based configuration management tool designed for simplicity and practicality. It provides a declarative way to manage server configurations without the complexity of enterprise frameworks.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Pure Python Configuration: No YAML or custom DSL required</li> <li>Drift Detection: Automatic detection and correction of configuration drift</li> <li>Recording Mode: Learn from manual changes and generate code</li> <li>SSH Transport: Local or remote execution with sudo support</li> <li>MCP Server Integration: AI-assisted infrastructure management</li> <li>Cross-Platform: Works on Linux and macOS</li> </ul>"},{"location":"#core-resources","title":"Core Resources","text":"<p>Cook provides fundamental building blocks for system configuration:</p> <ul> <li>File: Manage files, directories, and templates (Jinja2)</li> <li>Package: Install and manage system packages (apt, dnf, pacman, brew)</li> <li>Repository: Manage package repositories and system updates</li> <li>Service: Control systemd and launchctl services</li> <li>Exec: Execute commands with idempotency guards</li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>from cook import File, Package, Service\n\nPackage(\"nginx\")\n\nFile(\"/etc/nginx/nginx.conf\",\n     content=\"\"\"\n     events { worker_connections 1024; }\n     http {\n         server {\n             listen 80;\n             location / { return 200 'Hello'; }\n         }\n     }\n     \"\"\",\n     mode=0o644)\n\nService(\"nginx\", running=True, enabled=True)\n</code></pre> <pre><code>cook plan server.py\ncook apply server.py\n</code></pre>"},{"location":"#use-cases","title":"Use Cases","text":"<p>Cook is designed for:</p> <ul> <li>VM provisioning and configuration</li> <li>Container image builds</li> <li>Local development environment setup</li> <li>Server fleet management</li> <li>Migration from cloud to physical servers</li> <li>Infrastructure as code without enterprise overhead</li> </ul>"},{"location":"#philosophy","title":"Philosophy","text":"<p>Cook fills the gap between shell scripts and enterprise configuration management. It provides:</p> <ul> <li>Testability: Pure Python enables unit and integration testing</li> <li>Observability: Clear logging and state tracking</li> <li>Simplicity: Direct mapping from desired state to implementation</li> <li>Integration: Python ecosystem enables easy customization</li> </ul>"},{"location":"#project-status","title":"Project Status","text":"<p>Cook is in beta with all core features implemented. Production use requires careful testing in your specific environment.</p>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>Installation Guide</li> <li>Quick Start</li> <li>Core Concepts</li> <li>Resource Reference</li> </ul>"},{"location":"LOGGING/","title":"Cook Logging System","text":"<p>Cook uses a centralized logging system built on Python's <code>logging</code> module with rich formatting via the <code>rich</code> library.</p>"},{"location":"LOGGING/#overview","title":"Overview","text":"<p>The logging system replaces all previous <code>print()</code>, <code>printf()</code>, and ANSI escape code statements with a structured, configurable logging framework that provides:</p> <ul> <li>Structured logging with multiple log levels (DEBUG, INFO, WARNING, ERROR, CRITICAL)</li> <li>Rich formatting with colors, styles, and visual hierarchy</li> <li>Context-aware output with special formatting for security warnings, dry-run mode, and resource actions</li> <li>Configurable verbosity via command-line flags</li> </ul>"},{"location":"LOGGING/#basic-usage","title":"Basic Usage","text":""},{"location":"LOGGING/#in-your-code","title":"In Your Code","text":"<pre><code>from cook.logging import get_logger, get_cook_logger\n\n# Standard Python logger\nlogger = get_logger(__name__)\nlogger.info(\"Processing resource\")\nlogger.warning(\"Resource has drifted\")\nlogger.error(\"Failed to apply changes\", exc_info=True)\n\n# Enhanced Cook logger with special formatting\nlogger = get_cook_logger(__name__)\nlogger.success(\"Resource applied successfully\")\nlogger.action(\"create\", \"file[/etc/nginx.conf]\")\nlogger.security_warning(\"Unsafe mode enabled\", resource=\"exec-resource\")\nlogger.dry_run(\"Would execute command: apt-get install nginx\")\n</code></pre>"},{"location":"LOGGING/#cli-configuration","title":"CLI Configuration","text":"<p>Control logging verbosity from the command line:</p> <pre><code># Default INFO level\ncook plan server.py\n\n# Debug mode (verbose output)\ncook --debug plan server.py\n\n# Quiet mode (errors only)\ncook --quiet apply server.py\n</code></pre>"},{"location":"LOGGING/#logger-types","title":"Logger Types","text":""},{"location":"LOGGING/#standard-logger-get_logger","title":"Standard Logger (<code>get_logger</code>)","text":"<p>Returns a standard Python <code>logging.Logger</code> instance with rich formatting:</p> <pre><code>from cook.logging import get_logger\n\nlogger = get_logger(__name__)\nlogger.debug(\"Detailed debugging information\")\nlogger.info(\"General information\")\nlogger.warning(\"Warning message\")\nlogger.error(\"Error occurred\")\nlogger.critical(\"Critical issue\")\n</code></pre>"},{"location":"LOGGING/#cook-logger-get_cook_logger","title":"Cook Logger (<code>get_cook_logger</code>)","text":"<p>Returns an enhanced <code>CookLogger</code> instance with Cook-specific formatting:</p> <pre><code>from cook.logging import get_cook_logger\n\nlogger = get_cook_logger(__name__)\n</code></pre>"},{"location":"LOGGING/#special-methods","title":"Special Methods","text":""},{"location":"LOGGING/#successmessage","title":"<code>success(message)</code>","text":"<p>Log success messages with green checkmark: <pre><code>logger.success(\"Resource applied successfully\")\n# Output: \u2713 Resource applied successfully\n</code></pre></p>"},{"location":"LOGGING/#actionaction-resource_id-detailsnone","title":"<code>action(action, resource_id, details=None)</code>","text":"<p>Log resource actions (create/update/delete): <pre><code>logger.action(\"create\", \"file[/etc/nginx.conf]\")\nlogger.action(\"update\", \"service[nginx]\", details=\"reloaded\")\nlogger.action(\"delete\", \"package[apache2]\")\n# Output:\n# + file[/etc/nginx.conf]\n# ~ service[nginx] (reloaded)\n# - package[apache2]\n</code></pre></p>"},{"location":"LOGGING/#security_warningmessage-resourcenone","title":"<code>security_warning(message, resource=None)</code>","text":"<p>Display prominent security warnings: <pre><code>logger.security_warning(\n    \"safe_mode=False disables security validation\",\n    resource=\"exec-resource\"\n)\n# Output:\n# ======================================================================\n# SECURITY WARNING: exec-resource\n# ======================================================================\n# safe_mode=False disables security validation\n# ======================================================================\n</code></pre></p>"},{"location":"LOGGING/#dry_runmessage","title":"<code>dry_run(message)</code>","text":"<p>Indicate dry-run mode operations: <pre><code>logger.dry_run(\"Would execute command: apt-get install nginx\")\n# Output: [DRY RUN] Would execute command: apt-get install nginx\n</code></pre></p>"},{"location":"LOGGING/#resource_statusresource_id-status-durationnone","title":"<code>resource_status(resource_id, status, duration=None)</code>","text":"<p>Log resource status updates: <pre><code>logger.resource_status(\"file[/etc/nginx.conf]\", \"done\", duration=0.45)\n# Output:   file[/etc/nginx.conf] ... done (0.45s)\n</code></pre></p>"},{"location":"LOGGING/#table_rowcolumns-widthsnone","title":"<code>table_row(*columns, widths=None)</code>","text":"<p>Print formatted table rows: <pre><code>logger.table_row(\"RESOURCE\", \"STATUS\", \"LAST APPLIED\", widths=[40, 12, 20])\nlogger.separator()\nlogger.table_row(\"file[/etc/nginx.conf]\", \"success\", \"2025-01-01 12:00\")\n</code></pre></p>"},{"location":"LOGGING/#separatorchar-length80","title":"<code>separator(char=\"-\", length=80)</code>","text":"<p>Print separator lines: <pre><code>logger.separator()          # Default: 80 hyphens\nlogger.separator(\"=\", 50)   # 50 equals signs\n</code></pre></p>"},{"location":"LOGGING/#configuration","title":"Configuration","text":""},{"location":"LOGGING/#setup-logging","title":"Setup Logging","text":"<p>Initialize logging at application startup:</p> <pre><code>from cook.logging import setup_logging\n\n# Default INFO level, no timestamps\nsetup_logging()\n\n# Debug mode with timestamps\nsetup_logging(level=\"DEBUG\", show_time=True)\n\n# Quiet mode, errors only\nsetup_logging(level=\"ERROR\", show_time=False)\n\n# Development mode with full context\nsetup_logging(\n    level=\"DEBUG\",\n    show_time=True,\n    show_path=True,\n    rich_tracebacks=True\n)\n</code></pre>"},{"location":"LOGGING/#log-levels","title":"Log Levels","text":"<ul> <li>DEBUG: Detailed diagnostic information</li> <li>INFO: General informational messages (default)</li> <li>WARNING: Warning messages for potential issues</li> <li>ERROR: Error messages for failures</li> <li>CRITICAL: Critical issues requiring immediate attention</li> </ul>"},{"location":"LOGGING/#color-theme","title":"Color Theme","text":"<p>Cook uses a custom color theme for consistent visual hierarchy:</p> <ul> <li>Success: Bold green</li> <li>Create action: Green <code>+</code></li> <li>Update action: Yellow <code>~</code></li> <li>Delete action: Red <code>-</code></li> <li>Security warnings: Bold red with separator</li> <li>Dry run: Cyan</li> <li>Errors: Bold red</li> <li>Warnings: Yellow</li> </ul>"},{"location":"LOGGING/#migration-from-print-statements","title":"Migration from Print Statements","text":""},{"location":"LOGGING/#before","title":"Before","text":"<pre><code>print(f\"Creating resource: {name}\")\nprint(f\"\\033[91mERROR: {error}\\033[0m\")  # Red ANSI\nprint(f\"\\033[93mWARNING: {warning}\\033[0m\")  # Yellow ANSI\n</code></pre>"},{"location":"LOGGING/#after","title":"After","text":"<pre><code>logger.info(f\"Creating resource: {name}\")\nlogger.error(f\"ERROR: {error}\")\nlogger.warning(f\"WARNING: {warning}\")\n</code></pre>"},{"location":"LOGGING/#best-practices","title":"Best Practices","text":"<ol> <li>Use appropriate log levels</li> <li>DEBUG: Detailed diagnostics</li> <li>INFO: Progress updates, status changes</li> <li>WARNING: Potential issues, drift detected</li> <li>ERROR: Failures that stop execution</li> <li> <p>CRITICAL: System-level failures</p> </li> <li> <p>Include context in messages <pre><code># Good\nlogger.info(f\"Applying resource: {resource.id}\")\n\n# Better\nlogger.action(\"update\", resource.id, details=\"configuration changed\")\n</code></pre></p> </li> <li> <p>Use structured formatting <pre><code># Use special methods for common patterns\nlogger.success(\"Resource applied\")           # Not logger.info(\"\u2713 Resource applied\")\nlogger.action(\"create\", resource_id)          # Not logger.info(f\"+ {resource_id}\")\nlogger.security_warning(msg, resource)        # Not print with ANSI codes\n</code></pre></p> </li> <li> <p>Avoid string formatting for large objects <pre><code># Good\nlogger.debug(\"Resource state: %s\", resource.state)\n\n# Bad (formats even if debug is disabled)\nlogger.debug(f\"Resource state: {resource.state}\")\n</code></pre></p> </li> <li> <p>Use exc_info for exceptions <pre><code>try:\n    apply_resource()\nexcept Exception as e:\n    logger.error(\"Failed to apply resource\", exc_info=True)\n</code></pre></p> </li> </ol>"},{"location":"LOGGING/#performance-considerations","title":"Performance Considerations","text":"<ul> <li>Logging is lazy-evaluated when using <code>%s</code> formatting</li> <li>Rich formatting only renders when messages are output</li> <li>Debug messages are skipped entirely when not in debug mode</li> <li>Use <code>logger.debug()</code> generously without performance concerns</li> </ul>"},{"location":"LOGGING/#examples","title":"Examples","text":""},{"location":"LOGGING/#resource-application","title":"Resource Application","text":"<pre><code>logger = get_cook_logger(__name__)\n\nlogger.info(\"Planning resource changes...\")\nfor resource in resources:\n    logger.action(\"create\", resource.id)\n\nlogger.info(\"\\nApplying changes...\")\nfor resource in changed_resources:\n    try:\n        resource.apply()\n        logger.resource_status(resource.id, \"done\", duration=0.5)\n    except Exception as e:\n        logger.error(f\"Failed to apply {resource.id}\", exc_info=True)\n\nlogger.success(f\"Apply complete! Changed {len(changed_resources)} resources\")\n</code></pre>"},{"location":"LOGGING/#security-validation","title":"Security Validation","text":"<pre><code>logger = get_cook_logger(__name__)\n\nif not safe_mode:\n    logger.security_warning(\n        \"safe_mode=False disables security validation\\n\"\n        f\"  Command: {command}\\n\"\n        \"  This is DANGEROUS with untrusted input.\",\n        resource=f\"Exec resource '{name}'\"\n    )\n</code></pre>"},{"location":"LOGGING/#dry-run-mode","title":"Dry Run Mode","text":"<pre><code>logger = get_cook_logger(__name__)\n\nif dry_run:\n    logger.dry_run(f\"Would execute: {command}\")\n    logger.info(f\"  Working directory: {cwd}\")\n    logger.info(f\"  Environment: {env}\")\n    return\n</code></pre>"},{"location":"api/core/","title":"Core API","text":"<p>Core abstractions and patterns in Cook.</p>"},{"location":"api/core/#overview","title":"Overview","text":"<p>Cook's core API provides the foundation for all resources and execution:</p> <ul> <li>Resource: Base class for all resources (File, Package, Service, etc.)</li> <li>Plan: Execution plan showing what will change</li> <li>Action: Type of change (CREATE, UPDATE, DELETE, NONE)</li> <li>Change: Individual property change</li> <li>Platform: System information (OS, distro, version)</li> <li>Executor: Manages resource execution and dependencies</li> </ul>"},{"location":"api/core/#check-plan-apply-pattern","title":"Check-Plan-Apply Pattern","text":"<p>Cook uses a three-phase execution model similar to Terraform:</p>"},{"location":"api/core/#1-check-phase","title":"1. Check Phase","text":"<p>Inspect current system state:</p> <pre><code>class MyResource(Resource):\n    def check(self, platform: Platform) -&gt; Dict[str, Any]:\n        # Return current state as dictionary\n        return {\n            \"exists\": True,\n            \"version\": \"1.0.0\",\n            \"enabled\": True\n        }\n</code></pre>"},{"location":"api/core/#2-plan-phase","title":"2. Plan Phase","text":"<p>Compare current state to desired state and generate a plan:</p> <pre><code># Cook automatically generates plan by comparing:\n# - Actual state (from check())\n# - Desired state (from desired_state())\n\n# Plan shows:\n# - Action: CREATE, UPDATE, DELETE, or NONE\n# - Changes: List of property changes\n</code></pre>"},{"location":"api/core/#3-apply-phase","title":"3. Apply Phase","text":"<p>Execute the plan:</p> <pre><code>class MyResource(Resource):\n    def apply(self, plan: Plan, platform: Platform) -&gt; None:\n        if plan.action == Action.CREATE:\n            # Create resource\n            pass\n        elif plan.action == Action.UPDATE:\n            # Update resource\n            for change in plan.changes:\n                # Apply each change\n                pass\n        elif plan.action == Action.DELETE:\n            # Delete resource\n            pass\n</code></pre>"},{"location":"api/core/#resource-base-class","title":"Resource Base Class","text":"<p>All resources inherit from <code>Resource</code>:</p> <pre><code>from cook.core import Resource, Platform, Plan, Action\nfrom typing import Dict, Any\n\nclass MyResource(Resource):\n    def __init__(self, name: str, **options):\n        super().__init__(name, **options)\n        # Resource-specific initialization\n\n    def resource_type(self) -&gt; str:\n        # Return resource type identifier\n        return \"myresource\"\n\n    def check(self, platform: Platform) -&gt; Dict[str, Any]:\n        # Return current state\n        return {\"exists\": False}\n\n    def desired_state(self) -&gt; Dict[str, Any]:\n        # Return desired state\n        return {\"exists\": True}\n\n    def apply(self, plan: Plan, platform: Platform) -&gt; None:\n        # Execute changes\n        pass\n</code></pre>"},{"location":"api/core/#resource-properties","title":"Resource Properties","text":"<p>Every resource has:</p> <ul> <li><code>id</code>: Unique identifier (<code>{type}:{name}</code>)</li> <li><code>name</code>: Resource name</li> <li><code>_transport</code>: Transport for executing commands</li> <li><code>_actual_state</code>: Current system state (from check)</li> <li><code>_desired_state</code>: Target state (from desired_state)</li> </ul>"},{"location":"api/core/#resource-methods","title":"Resource Methods","text":""},{"location":"api/core/#resource_type","title":"resource_type()","text":"<p>Return resource type identifier:</p> <pre><code>def resource_type(self) -&gt; str:\n    return \"pkg\"  # For Package resource\n</code></pre> <p>Used in resource IDs: <code>pkg:nginx</code></p>"},{"location":"api/core/#checkplatform","title":"check(platform)","text":"<p>Inspect current system state:</p> <pre><code>def check(self, platform: Platform) -&gt; Dict[str, Any]:\n    # Query system\n    exists = self._transport.file_exists(\"/etc/myapp.conf\")\n\n    return {\n        \"exists\": exists,\n        \"version\": \"1.0.0\" if exists else None\n    }\n</code></pre>"},{"location":"api/core/#desired_state","title":"desired_state()","text":"<p>Define target state:</p> <pre><code>def desired_state(self) -&gt; Dict[str, Any]:\n    return {\n        \"exists\": True,\n        \"version\": \"2.0.0\"\n    }\n</code></pre>"},{"location":"api/core/#applyplan-platform","title":"apply(plan, platform)","text":"<p>Execute changes:</p> <pre><code>def apply(self, plan: Plan, platform: Platform) -&gt; None:\n    if plan.action == Action.CREATE:\n        # Create resource\n        self._transport.run_command([\"create\", \"resource\"])\n    elif plan.action == Action.UPDATE:\n        # Update resource\n        for change in plan.changes:\n            # Handle each change\n            pass\n</code></pre>"},{"location":"api/core/#plan","title":"Plan","text":"<p>Execution plan showing what will change.</p>"},{"location":"api/core/#properties","title":"Properties","text":"<pre><code>@dataclass\nclass Plan:\n    action: Action              # What action to take\n    changes: List[Change]       # List of changes\n    reason: str                 # Why this action\n</code></pre>"},{"location":"api/core/#methods","title":"Methods","text":"<pre><code>plan = Plan(action=Action.UPDATE, changes=[...])\n\n# Check if plan has changes\nif plan.has_changes():\n    print(\"Changes detected\")\n\n# String representation\nprint(plan)\n# Output:\n# Action: update\n#   version: 1.0.0 \u2192 2.0.0\n#   enabled: false \u2192 true\n</code></pre>"},{"location":"api/core/#example","title":"Example","text":"<pre><code>from cook.core import Plan, Action, Change\n\nplan = Plan(\n    action=Action.UPDATE,\n    changes=[\n        Change(\"version\", \"1.0.0\", \"2.0.0\"),\n        Change(\"enabled\", False, True)\n    ],\n    reason=\"Version upgrade required\"\n)\n\nprint(plan)\n# Action: update\n# Reason: Version upgrade required\n#   version: 1.0.0 \u2192 2.0.0\n#   enabled: false \u2192 true\n</code></pre>"},{"location":"api/core/#action","title":"Action","text":"<p>Resource action enumeration.</p>"},{"location":"api/core/#values","title":"Values","text":"<pre><code>class Action(Enum):\n    NONE = \"none\"       # No changes\n    CREATE = \"create\"   # Resource doesn't exist\n    UPDATE = \"update\"   # Resource exists but differs\n    DELETE = \"delete\"   # Resource should be removed\n</code></pre>"},{"location":"api/core/#usage","title":"Usage","text":"<pre><code>from cook.core import Action\n\nif plan.action == Action.CREATE:\n    # Create new resource\n    pass\nelif plan.action == Action.UPDATE:\n    # Update existing resource\n    pass\nelif plan.action == Action.DELETE:\n    # Remove resource\n    pass\nelif plan.action == Action.NONE:\n    # No changes needed\n    pass\n</code></pre>"},{"location":"api/core/#change","title":"Change","text":"<p>Individual property change.</p>"},{"location":"api/core/#properties_1","title":"Properties","text":"<pre><code>@dataclass\nclass Change:\n    field: str          # Property name\n    from_value: Any     # Current value\n    to_value: Any       # Target value\n</code></pre>"},{"location":"api/core/#example_1","title":"Example","text":"<pre><code>from cook.core import Change\n\nchange = Change(\"version\", \"1.0.0\", \"2.0.0\")\nprint(change)\n# version: 1.0.0 \u2192 2.0.0\n\n# Access properties\nprint(change.field)       # \"version\"\nprint(change.from_value)  # \"1.0.0\"\nprint(change.to_value)    # \"2.0.0\"\n</code></pre>"},{"location":"api/core/#platform","title":"Platform","text":"<p>System information (OS, distribution, version, architecture).</p>"},{"location":"api/core/#properties_2","title":"Properties","text":"<pre><code>@dataclass\nclass Platform:\n    system: str    # Linux, Darwin, Windows\n    distro: str    # ubuntu, debian, fedora, arch, etc.\n    version: str   # OS version\n    arch: str      # x86_64, arm64, etc.\n</code></pre>"},{"location":"api/core/#detection","title":"Detection","text":"<pre><code>from cook.core import Platform\n\n# Detect local platform\nplatform = Platform.detect()\n\nprint(platform.system)   # \"Linux\"\nprint(platform.distro)   # \"ubuntu\"\nprint(platform.version)  # \"22.04\"\nprint(platform.arch)     # \"x86_64\"\n</code></pre>"},{"location":"api/core/#usage-in-resources","title":"Usage in Resources","text":"<pre><code>def apply(self, plan: Plan, platform: Platform) -&gt; None:\n    if platform.system == \"Linux\":\n        # Linux-specific logic\n        if platform.distro == \"ubuntu\":\n            # Ubuntu-specific\n            pass\n    elif platform.system == \"Darwin\":\n        # macOS-specific logic\n        pass\n</code></pre>"},{"location":"api/core/#executor","title":"Executor","text":"<p>Manages resource registration and execution.</p>"},{"location":"api/core/#get-executor","title":"Get Executor","text":"<pre><code>from cook.core.executor import get_executor\n\nexecutor = get_executor()\n</code></pre>"},{"location":"api/core/#add-resources","title":"Add Resources","text":"<pre><code># Resources auto-register on creation\nfrom cook import File\n\n# This automatically adds to executor\nFile(\"/etc/motd\", content=\"Welcome\")\n\n# Or manually\nexecutor.add(resource)\n</code></pre>"},{"location":"api/core/#execute-resources","title":"Execute Resources","text":"<pre><code>from cook.core import Platform\n\nplatform = Platform.detect()\n\n# Execute all resources\nexecutor.execute(platform)\n</code></pre>"},{"location":"api/core/#plan-all-resources","title":"Plan All Resources","text":"<pre><code># Generate plans without executing\nplans = executor.plan_all(platform)\n\nfor resource_id, plan in plans.items():\n    if plan.has_changes():\n        print(f\"{resource_id}: {plan}\")\n</code></pre>"},{"location":"api/core/#creating-custom-resources","title":"Creating Custom Resources","text":""},{"location":"api/core/#basic-resource","title":"Basic Resource","text":"<pre><code>from cook.core import Resource, Platform, Plan, Action\nfrom cook.core.executor import get_executor\nfrom typing import Dict, Any\n\nclass CustomResource(Resource):\n    def __init__(self, name: str, value: str, **options):\n        super().__init__(name, **options)\n        self.value = value\n\n        # Auto-register\n        get_executor().add(self)\n\n    def resource_type(self) -&gt; str:\n        return \"custom\"\n\n    def check(self, platform: Platform) -&gt; Dict[str, Any]:\n        # Check current state\n        exists = self._transport.file_exists(f\"/tmp/{self.name}\")\n\n        return {\n            \"exists\": exists,\n            \"value\": None  # Could read from file\n        }\n\n    def desired_state(self) -&gt; Dict[str, Any]:\n        return {\n            \"exists\": True,\n            \"value\": self.value\n        }\n\n    def apply(self, plan: Plan, platform: Platform) -&gt; None:\n        if plan.action == Action.CREATE:\n            # Create resource\n            content = self.value.encode()\n            self._transport.write_file(f\"/tmp/{self.name}\", content)\n        elif plan.action == Action.UPDATE:\n            # Update resource\n            for change in plan.changes:\n                if change.field == \"value\":\n                    content = change.to_value.encode()\n                    self._transport.write_file(f\"/tmp/{self.name}\", content)\n        elif plan.action == Action.DELETE:\n            # Delete resource\n            self._transport.run_command([\"rm\", f\"/tmp/{self.name}\"])\n</code></pre>"},{"location":"api/core/#using-custom-resource","title":"Using Custom Resource","text":"<pre><code># Create resource\nCustomResource(\"myfile\", value=\"Hello World\")\n\n# Execute\nfrom cook.core.executor import get_executor\nfrom cook.core import Platform\n\nexecutor = get_executor()\nplatform = Platform.detect()\nexecutor.execute(platform)\n</code></pre>"},{"location":"api/core/#transport-integration","title":"Transport Integration","text":"<p>Resources use transport for all system operations:</p> <pre><code># File operations\nexists = self._transport.file_exists(\"/path/to/file\")\ncontent = self._transport.read_file(\"/path/to/file\")\nself._transport.write_file(\"/path/to/file\", b\"content\")\n\n# Command execution\noutput, code = self._transport.run_command([\"ls\", \"-la\"])\n\n# Shell execution\noutput, code = self._transport.run_shell(\"echo 'hello'\")\n</code></pre> <p>See Transport API for details.</p>"},{"location":"api/core/#error-handling","title":"Error Handling","text":""},{"location":"api/core/#validation-errors","title":"Validation Errors","text":"<p>Raise exceptions during initialization:</p> <pre><code>def __init__(self, name: str, value: str):\n    if not value:\n        raise ValueError(\"value cannot be empty\")\n    super().__init__(name)\n</code></pre>"},{"location":"api/core/#execution-errors","title":"Execution Errors","text":"<p>Raise exceptions during apply:</p> <pre><code>def apply(self, plan: Plan, platform: Platform) -&gt; None:\n    output, code = self._transport.run_command([\"mycommand\"])\n    if code != 0:\n        raise RuntimeError(f\"Command failed: {output}\")\n</code></pre>"},{"location":"api/core/#api-reference","title":"API Reference","text":""},{"location":"api/core/#core-module","title":"Core Module","text":"<p>See cook/core/resource.py for complete source code.</p>"},{"location":"api/core/#key-imports","title":"Key Imports","text":"<pre><code>from cook.core import Resource, Plan, Action, Change, Platform\nfrom cook.core.executor import get_executor, reset_executor\n</code></pre>"},{"location":"api/resources/","title":"Resources API","text":"<p>Guide to using and creating Cook resources.</p>"},{"location":"api/resources/#overview","title":"Overview","text":"<p>Resources are the building blocks of Cook configurations. Each resource represents a piece of desired system state.</p>"},{"location":"api/resources/#built-in-resources","title":"Built-in Resources","text":"<p>Cook provides five core resources:</p> Resource Purpose Example File Manage files and directories <code>File(\"/etc/motd\", content=\"...\")</code> Package Install system packages <code>Package(\"nginx\")</code> Repository Manage package repositories <code>Repository(\"apt-update\", action=\"update\")</code> Service Manage system services <code>Service(\"nginx\", running=True)</code> Exec Run arbitrary commands <code>Exec(\"backup\", command=\"...\")</code>"},{"location":"api/resources/#resource-lifecycle","title":"Resource Lifecycle","text":"<p>All resources follow the Check-Plan-Apply pattern:</p>"},{"location":"api/resources/#1-check-phase","title":"1. Check Phase","text":"<p>Resource inspects current system state:</p> <pre><code>from cook import File\n\nfile = File(\"/etc/motd\", content=\"Welcome\")\n# During check phase, reads /etc/motd\n# Returns: {\"exists\": True, \"content\": \"Old message\"}\n</code></pre>"},{"location":"api/resources/#2-plan-phase","title":"2. Plan Phase","text":"<p>Cook compares actual vs desired state:</p> <pre><code># Actual state:  {\"exists\": True, \"content\": \"Old message\"}\n# Desired state: {\"exists\": True, \"content\": \"Welcome\"}\n\n# Generated plan:\n# Action: UPDATE\n# Changes:\n#   content: \"Old message\" \u2192 \"Welcome\"\n</code></pre>"},{"location":"api/resources/#3-apply-phase","title":"3. Apply Phase","text":"<p>Resource executes changes:</p> <pre><code># Writes \"Welcome\" to /etc/motd\n</code></pre>"},{"location":"api/resources/#resource-identity","title":"Resource Identity","text":"<p>Each resource has a unique ID:</p> <pre><code>from cook import File, Package\n\nfile = File(\"/etc/motd\", content=\"Welcome\")\nprint(file.id)  # \"file:/etc/motd\"\n\npkg = Package(\"nginx\")\nprint(pkg.id)  # \"pkg:nginx\"\n</code></pre> <p>ID format: <code>{resource_type}:{name}</code></p>"},{"location":"api/resources/#resource-dependencies","title":"Resource Dependencies","text":"<p>Resources automatically track dependencies through references:</p>"},{"location":"api/resources/#reload-on-change","title":"Reload on Change","text":"<pre><code>from cook import File, Service\n\n# Configuration file\nnginx_conf = File(\"/etc/nginx/nginx.conf\", source=\"./nginx.conf\")\n\n# Service reloads when config changes\nService(\"nginx\", running=True, reload_on=[nginx_conf])\n</code></pre>"},{"location":"api/resources/#restart-on-change","title":"Restart on Change","text":"<pre><code>from cook import File, Service\n\n# Application binary\napp_binary = File(\"/usr/local/bin/app\", source=\"./app\", mode=0o755)\n\n# Service restarts when binary changes\nService(\"app\", running=True, restart_on=[app_binary])\n</code></pre>"},{"location":"api/resources/#execution-order","title":"Execution Order","text":"<p>Cook automatically orders resources based on dependencies:</p> <pre><code>from cook import File, Package, Service\n\n# Cook executes in this order:\nPackage(\"nginx\")                                    # 1. Install first\nconfig = File(\"/etc/nginx/nginx.conf\", ...)        # 2. Then configure\nService(\"nginx\", running=True, reload_on=[config]) # 3. Then manage service\n</code></pre>"},{"location":"api/resources/#resource-parameters","title":"Resource Parameters","text":""},{"location":"api/resources/#common-parameters","title":"Common Parameters","text":"<p>All resources support these parameters:</p> <pre><code>from cook import File\n\nFile(\n    \"/etc/motd\",\n    content=\"Welcome\",\n    # Common parameters:\n    # (none currently - resource-specific)\n)\n</code></pre>"},{"location":"api/resources/#resource-specific-parameters","title":"Resource-Specific Parameters","text":"<p>Each resource type has its own parameters:</p> <pre><code># File resource\nFile(\n    path=\"/etc/motd\",\n    content=\"Welcome\",      # File-specific\n    mode=0o644,            # File-specific\n    owner=\"root\"           # File-specific\n)\n\n# Package resource\nPackage(\n    name=\"nginx\",\n    version=\"1.18.0\",      # Package-specific\n    ensure=\"present\"       # Package-specific\n)\n\n# Service resource\nService(\n    name=\"nginx\",\n    running=True,          # Service-specific\n    enabled=True,          # Service-specific\n    reload_on=[...]        # Service-specific\n)\n</code></pre>"},{"location":"api/resources/#creating-custom-resources","title":"Creating Custom Resources","text":""},{"location":"api/resources/#basic-custom-resource","title":"Basic Custom Resource","text":"<pre><code>from cook.core import Resource, Platform, Plan, Action\nfrom cook.core.executor import get_executor\nfrom typing import Dict, Any\n\nclass DatabaseUser(Resource):\n    \"\"\"Create database users.\"\"\"\n\n    def __init__(self, username: str, password: str, database: str, **options):\n        super().__init__(username, **options)\n        self.username = username\n        self.password = password\n        self.database = database\n\n        # Auto-register with executor\n        get_executor().add(self)\n\n    def resource_type(self) -&gt; str:\n        return \"dbuser\"\n\n    def check(self, platform: Platform) -&gt; Dict[str, Any]:\n        \"\"\"Check if user exists.\"\"\"\n        cmd = f\"psql -c \\\"SELECT 1 FROM pg_user WHERE usename='{self.username}'\\\"\"\n        output, code = self._transport.run_shell(cmd)\n\n        return {\n            \"exists\": code == 0 and \"1 row\" in output\n        }\n\n    def desired_state(self) -&gt; Dict[str, Any]:\n        \"\"\"User should exist.\"\"\"\n        return {\n            \"exists\": True\n        }\n\n    def apply(self, plan: Plan, platform: Platform) -&gt; None:\n        \"\"\"Create user.\"\"\"\n        if plan.action == Action.CREATE:\n            cmd = f\"psql -c \\\"CREATE USER {self.username} WITH PASSWORD '{self.password}'\\\"\"\n            self._transport.run_shell(cmd)\n\n            # Grant access\n            cmd = f\"psql -c \\\"GRANT ALL ON DATABASE {self.database} TO {self.username}\\\"\"\n            self._transport.run_shell(cmd)\n</code></pre>"},{"location":"api/resources/#using-custom-resource","title":"Using Custom Resource","text":"<pre><code># Create database user\nDatabaseUser(\"app_user\", password=\"secret\", database=\"myapp\")\n\n# Execute\nfrom cook.core.executor import get_executor\nfrom cook.core import Platform\n\nexecutor = get_executor()\nplatform = Platform.detect()\nexecutor.execute(platform)\n</code></pre>"},{"location":"api/resources/#advanced-custom-resource","title":"Advanced Custom Resource","text":"<p>With update and delete support:</p> <pre><code>class GitRepository(Resource):\n    \"\"\"Manage git repositories.\"\"\"\n\n    def __init__(self, path: str, url: str, branch: str = \"main\", **options):\n        super().__init__(path, **options)\n        self.path = path\n        self.url = url\n        self.branch = branch\n        get_executor().add(self)\n\n    def resource_type(self) -&gt; str:\n        return \"git\"\n\n    def check(self, platform: Platform) -&gt; Dict[str, Any]:\n        \"\"\"Check repository state.\"\"\"\n        if not self._transport.file_exists(f\"{self.path}/.git\"):\n            return {\"exists\": False, \"branch\": None, \"url\": None}\n\n        # Get current branch\n        output, _ = self._transport.run_shell(\n            f\"cd {self.path} &amp;&amp; git rev-parse --abbrev-ref HEAD\"\n        )\n        current_branch = output.strip()\n\n        # Get remote URL\n        output, _ = self._transport.run_shell(\n            f\"cd {self.path} &amp;&amp; git config --get remote.origin.url\"\n        )\n        current_url = output.strip()\n\n        return {\n            \"exists\": True,\n            \"branch\": current_branch,\n            \"url\": current_url\n        }\n\n    def desired_state(self) -&gt; Dict[str, Any]:\n        \"\"\"Desired repository state.\"\"\"\n        return {\n            \"exists\": True,\n            \"branch\": self.branch,\n            \"url\": self.url\n        }\n\n    def apply(self, plan: Plan, platform: Platform) -&gt; None:\n        \"\"\"Apply git operations.\"\"\"\n        if plan.action == Action.CREATE:\n            # Clone repository\n            self._transport.run_command(\n                [\"git\", \"clone\", \"-b\", self.branch, self.url, self.path]\n            )\n\n        elif plan.action == Action.UPDATE:\n            # Handle changes\n            for change in plan.changes:\n                if change.field == \"branch\":\n                    # Checkout branch\n                    self._transport.run_shell(\n                        f\"cd {self.path} &amp;&amp; git checkout {change.to_value}\"\n                    )\n                elif change.field == \"url\":\n                    # Update remote\n                    self._transport.run_shell(\n                        f\"cd {self.path} &amp;&amp; git remote set-url origin {change.to_value}\"\n                    )\n\n        elif plan.action == Action.DELETE:\n            # Remove repository\n            self._transport.run_command([\"rm\", \"-rf\", self.path])\n</code></pre>"},{"location":"api/resources/#resource-best-practices","title":"Resource Best Practices","text":""},{"location":"api/resources/#idempotency","title":"Idempotency","text":"<p>Resources should be idempotent - safe to run multiple times:</p> <pre><code>def check(self, platform: Platform) -&gt; Dict[str, Any]:\n    # Always check current state accurately\n    exists = self._transport.file_exists(self.path)\n    return {\"exists\": exists}\n\ndef apply(self, plan: Plan, platform: Platform) -&gt; None:\n    # Only make changes when needed\n    if plan.action == Action.CREATE:\n        # Create only if doesn't exist\n        pass\n</code></pre>"},{"location":"api/resources/#error-handling","title":"Error Handling","text":"<p>Validate inputs and handle errors:</p> <pre><code>def __init__(self, name: str, value: str):\n    # Validate inputs\n    if not name:\n        raise ValueError(\"name cannot be empty\")\n    if not value:\n        raise ValueError(\"value cannot be empty\")\n\n    super().__init__(name)\n\ndef apply(self, plan: Plan, platform: Platform) -&gt; None:\n    # Check command success\n    output, code = self._transport.run_command([\"mycommand\"])\n    if code != 0:\n        raise RuntimeError(f\"Command failed: {output}\")\n</code></pre>"},{"location":"api/resources/#platform-detection","title":"Platform Detection","text":"<p>Use platform information for cross-platform resources:</p> <pre><code>def apply(self, plan: Plan, platform: Platform) -&gt; None:\n    if platform.system == \"Linux\":\n        if platform.distro == \"ubuntu\":\n            self._transport.run_command([\"apt-get\", \"install\", \"...\"])\n        elif platform.distro == \"fedora\":\n            self._transport.run_command([\"dnf\", \"install\", \"...\"])\n    elif platform.system == \"Darwin\":\n        self._transport.run_command([\"brew\", \"install\", \"...\"])\n</code></pre>"},{"location":"api/resources/#transport-usage","title":"Transport Usage","text":"<p>Always use transport for system operations:</p> <pre><code># Good: Use transport\nexists = self._transport.file_exists(\"/path/to/file\")\ncontent = self._transport.read_file(\"/path/to/file\")\nself._transport.write_file(\"/path/to/file\", b\"content\")\n\n# Bad: Direct file operations (won't work with SSH transport)\nimport os\nos.path.exists(\"/path/to/file\")  # WRONG - only works locally\n</code></pre>"},{"location":"api/resources/#resource-testing","title":"Resource Testing","text":""},{"location":"api/resources/#unit-tests","title":"Unit Tests","text":"<p>Test resources with mock transport:</p> <pre><code>from cook.transport import LocalTransport\nfrom cook.core import Platform\n\nclass MockTransport:\n    def __init__(self):\n        self.files = {}\n        self.commands = []\n\n    def file_exists(self, path: str) -&gt; bool:\n        return path in self.files\n\n    def read_file(self, path: str) -&gt; bytes:\n        return self.files.get(path, b\"\")\n\n    def write_file(self, path: str, content: bytes) -&gt; None:\n        self.files[path] = content\n\n# Test resource\ndef test_custom_resource():\n    # Create mock transport\n    transport = MockTransport()\n\n    # Create resource\n    resource = CustomResource(\"test\", value=\"hello\")\n    resource._transport = transport\n\n    # Check state\n    platform = Platform.detect()\n    state = resource.check(platform)\n    assert state[\"exists\"] == False\n\n    # Apply changes\n    plan = Plan(action=Action.CREATE, changes=[])\n    resource.apply(plan, platform)\n\n    # Verify\n    assert transport.files[\"/tmp/test\"] == b\"hello\"\n</code></pre>"},{"location":"api/resources/#resource-patterns","title":"Resource Patterns","text":""},{"location":"api/resources/#configuration-file-service","title":"Configuration File + Service","text":"<pre><code>from cook import File, Service\n\n# Configuration file\nconfig = File(\"/etc/nginx/nginx.conf\", source=\"./nginx.conf\")\n\n# Service that reloads on config change\nService(\"nginx\", running=True, enabled=True, reload_on=[config])\n</code></pre>"},{"location":"api/resources/#package-service","title":"Package + Service","text":"<pre><code>from cook import Package, Service\n\n# Install package\nPackage(\"postgresql\")\n\n# Manage service\nService(\"postgresql\", running=True, enabled=True)\n</code></pre>"},{"location":"api/resources/#multi-resource-setup","title":"Multi-Resource Setup","text":"<pre><code>from cook import File, Package, Service\n\n# Create directory\nFile(\"/opt/apps/myapp\", ensure=\"directory\", mode=0o755)\n\n# Install dependencies\nPackage(\"app-deps\", packages=[\"python3\", \"python3-pip\"])\n\n# Application files\napp_config = File(\"/opt/apps/myapp/config.yml\", source=\"./config.yml\")\napp_binary = File(\"/opt/apps/myapp/app\", source=\"./app\", mode=0o755)\n\n# Service file\nservice_file = File(\n    \"/etc/systemd/system/myapp.service\",\n    source=\"./myapp.service\"\n)\n\n# Manage service\nService(\n    \"myapp\",\n    running=True,\n    enabled=True,\n    reload_on=[app_config],\n    restart_on=[app_binary, service_file]\n)\n</code></pre>"},{"location":"api/resources/#api-reference","title":"API Reference","text":""},{"location":"api/resources/#resource-base-class","title":"Resource Base Class","text":"<p>See cook/core/resource.py for the base Resource class.</p>"},{"location":"api/resources/#built-in-resources_1","title":"Built-in Resources","text":"<ul> <li>File</li> <li>Package</li> <li>Repository</li> <li>Service</li> <li>Exec</li> </ul>"},{"location":"api/resources/#resource-imports","title":"Resource Imports","text":"<pre><code># Import built-in resources\nfrom cook import File, Package, Repository, Service, Exec\n\n# Import core classes for custom resources\nfrom cook.core import Resource, Platform, Plan, Action, Change\nfrom cook.core.executor import get_executor\n</code></pre>"},{"location":"api/transport/","title":"Transport API","text":"<p>Transport layer for local and remote execution.</p>"},{"location":"api/transport/#overview","title":"Overview","text":"<p>Transport abstracts command execution and file operations:</p> <ul> <li>LocalTransport: Execute commands locally</li> <li>SSHTransport: Execute commands via SSH (future)</li> <li>NullTransport: No-op transport for testing</li> </ul> <p>Resources use transport for all system interactions, enabling the same configuration to work locally or remotely.</p>"},{"location":"api/transport/#transport-interface","title":"Transport Interface","text":"<p>All transports implement these methods:</p>"},{"location":"api/transport/#file-operations","title":"File Operations","text":"<pre><code># Check if file exists\nexists: bool = transport.file_exists(\"/path/to/file\")\n\n# Read file content\ncontent: bytes = transport.read_file(\"/path/to/file\")\n\n# Write file content\ntransport.write_file(\"/path/to/file\", b\"content\")\n</code></pre>"},{"location":"api/transport/#command-execution","title":"Command Execution","text":"<pre><code># Run command\noutput: str\ncode: int\noutput, code = transport.run_command([\"ls\", \"-la\", \"/tmp\"])\n\n# Run shell command\noutput, code = transport.run_shell(\"echo 'hello' &gt; /tmp/test.txt\")\n</code></pre>"},{"location":"api/transport/#localtransport","title":"LocalTransport","text":"<p>Execute commands on the local system.</p>"},{"location":"api/transport/#usage","title":"Usage","text":"<pre><code>from cook.transport import LocalTransport\n\ntransport = LocalTransport()\n\n# File operations\nexists = transport.file_exists(\"/etc/hosts\")\ncontent = transport.read_file(\"/etc/hosts\")\n\n# Command execution\noutput, code = transport.run_command([\"uname\", \"-a\"])\nprint(f\"Output: {output}\")\nprint(f\"Exit code: {code}\")\n</code></pre>"},{"location":"api/transport/#configuration","title":"Configuration","text":"<p>LocalTransport is the default for all resources:</p> <pre><code>from cook import File\n\n# Uses LocalTransport by default\nFile(\"/etc/motd\", content=\"Welcome\")\n</code></pre>"},{"location":"api/transport/#examples","title":"Examples","text":""},{"location":"api/transport/#file-operations_1","title":"File Operations","text":"<pre><code>from cook.transport import LocalTransport\n\ntransport = LocalTransport()\n\n# Check existence\nif transport.file_exists(\"/etc/motd\"):\n    # Read content\n    content = transport.read_file(\"/etc/motd\")\n    print(content.decode())\n\n# Write content\ntransport.write_file(\"/tmp/test.txt\", b\"Hello World\")\n</code></pre>"},{"location":"api/transport/#command-execution_1","title":"Command Execution","text":"<pre><code>transport = LocalTransport()\n\n# Run command\noutput, code = transport.run_command([\"ls\", \"-la\", \"/tmp\"])\nif code == 0:\n    print(f\"Directory listing:\\n{output}\")\n\n# Run shell command\noutput, code = transport.run_shell(\"cat /etc/os-release | grep VERSION\")\nprint(output)\n</code></pre>"},{"location":"api/transport/#sshtransport","title":"SSHTransport","text":"<p>Execute commands on remote systems via SSH (future implementation).</p>"},{"location":"api/transport/#planned-usage","title":"Planned Usage","text":"<pre><code>from cook.transport import SSHTransport\n\n# Connect to remote host\ntransport = SSHTransport(\n    host=\"server.example.com\",\n    username=\"deploy\",\n    key_file=\"/home/user/.ssh/id_rsa\"\n)\n\n# Use with resources\nfrom cook import File\n\nfile = File(\"/etc/motd\", content=\"Welcome\")\nfile._transport = transport\n\n# Execute remotely\nfrom cook.core.executor import get_executor\nfrom cook.core import Platform\n\nexecutor = get_executor()\nplatform = Platform.detect(transport)\nexecutor.execute(platform)\n</code></pre>"},{"location":"api/transport/#planned-features","title":"Planned Features","text":"<ul> <li>SSH key authentication</li> <li>Password authentication</li> <li>Connection pooling</li> <li>SFTP for file transfer</li> <li>Command output streaming</li> </ul>"},{"location":"api/transport/#nulltransport","title":"NullTransport","text":"<p>No-op transport for testing.</p>"},{"location":"api/transport/#usage_1","title":"Usage","text":"<pre><code>from cook.transport import NullTransport\n\ntransport = NullTransport()\n\n# All operations return empty/false\nexists = transport.file_exists(\"/any/path\")  # Always False\ncontent = transport.read_file(\"/any/path\")    # Empty bytes\noutput, code = transport.run_command([\"ls\"])  # Empty output, code 0\n</code></pre>"},{"location":"api/transport/#testing-example","title":"Testing Example","text":"<pre><code>from cook import File\nfrom cook.transport import NullTransport\nfrom cook.core import Platform, Action\n\n# Create resource\nfile = File(\"/etc/motd\", content=\"Welcome\")\n\n# Use null transport (no actual operations)\nfile._transport = NullTransport()\n\n# Check state (won't actually check file)\nplatform = Platform.detect()\nstate = file.check(platform)\nprint(state)  # {\"exists\": False, ...}\n</code></pre>"},{"location":"api/transport/#using-transport-in-resources","title":"Using Transport in Resources","text":"<p>Resources access transport via <code>self._transport</code>:</p>"},{"location":"api/transport/#file-operations_2","title":"File Operations","text":"<pre><code>class MyResource(Resource):\n    def check(self, platform: Platform) -&gt; Dict[str, Any]:\n        # Check if file exists\n        if self._transport.file_exists(\"/path/to/file\"):\n            # Read file\n            content = self._transport.read_file(\"/path/to/file\")\n            return {\"exists\": True, \"content\": content.decode()}\n        return {\"exists\": False}\n\n    def apply(self, plan: Plan, platform: Platform) -&gt; None:\n        # Write file\n        content = \"Hello World\".encode()\n        self._transport.write_file(\"/path/to/file\", content)\n</code></pre>"},{"location":"api/transport/#command-execution_2","title":"Command Execution","text":"<pre><code>class MyResource(Resource):\n    def check(self, platform: Platform) -&gt; Dict[str, Any]:\n        # Run command\n        output, code = self._transport.run_command([\"systemctl\", \"is-active\", \"nginx\"])\n        return {\"running\": code == 0}\n\n    def apply(self, plan: Plan, platform: Platform) -&gt; None:\n        # Start service\n        output, code = self._transport.run_command([\"systemctl\", \"start\", \"nginx\"])\n        if code != 0:\n            raise RuntimeError(f\"Failed to start service: {output}\")\n</code></pre>"},{"location":"api/transport/#shell-commands","title":"Shell Commands","text":"<pre><code>class MyResource(Resource):\n    def apply(self, plan: Plan, platform: Platform) -&gt; None:\n        # Run shell command with pipes/redirects\n        output, code = self._transport.run_shell(\n            \"cat /var/log/app.log | grep ERROR &gt; /tmp/errors.txt\"\n        )\n</code></pre>"},{"location":"api/transport/#transport-methods","title":"Transport Methods","text":""},{"location":"api/transport/#file_exists","title":"file_exists()","text":"<p>Check if file or directory exists.</p> <pre><code>exists: bool = transport.file_exists(\"/path/to/file\")\n</code></pre> <p>Parameters: - <code>path</code>: File or directory path</p> <p>Returns: - <code>bool</code>: True if exists, False otherwise</p> <p>Example:</p> <pre><code>if transport.file_exists(\"/etc/nginx/nginx.conf\"):\n    print(\"Nginx is configured\")\n</code></pre>"},{"location":"api/transport/#read_file","title":"read_file()","text":"<p>Read file content as bytes.</p> <pre><code>content: bytes = transport.read_file(\"/path/to/file\")\n</code></pre> <p>Parameters: - <code>path</code>: File path</p> <p>Returns: - <code>bytes</code>: File content</p> <p>Raises: - <code>FileNotFoundError</code>: If file doesn't exist</p> <p>Example:</p> <pre><code>content = transport.read_file(\"/etc/hostname\")\nhostname = content.decode().strip()\nprint(f\"Hostname: {hostname}\")\n</code></pre>"},{"location":"api/transport/#write_file","title":"write_file()","text":"<p>Write content to file.</p> <pre><code>transport.write_file(\"/path/to/file\", b\"content\")\n</code></pre> <p>Parameters: - <code>path</code>: File path - <code>content</code>: File content as bytes</p> <p>Example:</p> <pre><code>content = \"Welcome to the server\".encode()\ntransport.write_file(\"/etc/motd\", content)\n</code></pre>"},{"location":"api/transport/#run_command","title":"run_command()","text":"<p>Run command with arguments.</p> <pre><code>output: str\ncode: int\noutput, code = transport.run_command([\"ls\", \"-la\", \"/tmp\"])\n</code></pre> <p>Parameters: - <code>args</code>: List of command and arguments</p> <p>Returns: - Tuple of <code>(output: str, exit_code: int)</code></p> <p>Example:</p> <pre><code>output, code = transport.run_command([\"apt-get\", \"update\"])\nif code == 0:\n    print(\"Package cache updated\")\nelse:\n    print(f\"Update failed: {output}\")\n</code></pre>"},{"location":"api/transport/#run_shell","title":"run_shell()","text":"<p>Run shell command (supports pipes, redirects, etc.).</p> <pre><code>output: str\ncode: int\noutput, code = transport.run_shell(\"echo 'hello' &gt; /tmp/test.txt\")\n</code></pre> <p>Parameters: - <code>command</code>: Shell command string</p> <p>Returns: - Tuple of <code>(output: str, exit_code: int)</code></p> <p>Security Warning: Shell commands can be dangerous. Validate all inputs.</p> <p>Example:</p> <pre><code># Pipe command output\noutput, code = transport.run_shell(\"cat /var/log/app.log | grep ERROR\")\n\n# Redirect output\noutput, code = transport.run_shell(\"echo 'data' &gt; /tmp/output.txt\")\n\n# Command chaining\noutput, code = transport.run_shell(\"cd /tmp &amp;&amp; ls -la\")\n</code></pre>"},{"location":"api/transport/#transport-best-practices","title":"Transport Best Practices","text":""},{"location":"api/transport/#use-run_command-when-possible","title":"Use run_command() When Possible","text":"<p>Prefer <code>run_command()</code> over <code>run_shell()</code>:</p> <pre><code># Good: Safe from injection\noutput, code = transport.run_command([\"ls\", \"-la\", directory])\n\n# Avoid: Shell injection risk\noutput, code = transport.run_shell(f\"ls -la {directory}\")\n</code></pre>"},{"location":"api/transport/#check-exit-codes","title":"Check Exit Codes","text":"<p>Always check command exit codes:</p> <pre><code>output, code = transport.run_command([\"systemctl\", \"start\", \"nginx\"])\nif code != 0:\n    raise RuntimeError(f\"Command failed: {output}\")\n</code></pre>"},{"location":"api/transport/#handle-binary-files","title":"Handle Binary Files","text":"<p>Files are transferred as bytes:</p> <pre><code># Read binary file\ncontent = transport.read_file(\"/path/to/image.png\")\n\n# Write binary file\ntransport.write_file(\"/path/to/image.png\", binary_data)\n</code></pre>"},{"location":"api/transport/#text-file-encoding","title":"Text File Encoding","text":"<p>Handle text file encoding explicitly:</p> <pre><code># Read text file\ncontent_bytes = transport.read_file(\"/etc/motd\")\ncontent_text = content_bytes.decode(\"utf-8\")\n\n# Write text file\ncontent_bytes = \"Welcome\".encode(\"utf-8\")\ntransport.write_file(\"/etc/motd\", content_bytes)\n</code></pre>"},{"location":"api/transport/#error-handling","title":"Error Handling","text":""},{"location":"api/transport/#file-not-found","title":"File Not Found","text":"<pre><code>try:\n    content = transport.read_file(\"/nonexistent/file\")\nexcept FileNotFoundError:\n    print(\"File does not exist\")\n</code></pre>"},{"location":"api/transport/#command-failure","title":"Command Failure","text":"<pre><code>output, code = transport.run_command([\"false\"])\nif code != 0:\n    print(f\"Command failed with exit code {code}\")\n</code></pre>"},{"location":"api/transport/#permission-denied","title":"Permission Denied","text":"<pre><code>output, code = transport.run_command([\"cat\", \"/root/secret\"])\nif code != 0:\n    print(f\"Permission denied: {output}\")\n</code></pre>"},{"location":"api/transport/#testing-with-mock-transport","title":"Testing with Mock Transport","text":"<p>Create mock transport for unit tests:</p> <pre><code>class MockTransport:\n    def __init__(self):\n        self.files = {}\n        self.commands = []\n\n    def file_exists(self, path: str) -&gt; bool:\n        return path in self.files\n\n    def read_file(self, path: str) -&gt; bytes:\n        if path not in self.files:\n            raise FileNotFoundError(path)\n        return self.files[path]\n\n    def write_file(self, path: str, content: bytes) -&gt; None:\n        self.files[path] = content\n\n    def run_command(self, args: list) -&gt; tuple[str, int]:\n        self.commands.append(args)\n        return \"\", 0\n\n    def run_shell(self, command: str) -&gt; tuple[str, int]:\n        self.commands.append(command)\n        return \"\", 0\n\n# Use in tests\ndef test_resource():\n    transport = MockTransport()\n    resource = MyResource(\"test\")\n    resource._transport = transport\n\n    # Test operations\n    platform = Platform.detect()\n    resource.check(platform)\n\n    # Verify\n    assert \"/path/to/file\" in transport.files\n    assert [\"systemctl\", \"start\", \"myservice\"] in transport.commands\n</code></pre>"},{"location":"api/transport/#api-reference","title":"API Reference","text":"<p>See cook/transport.py for complete transport implementation.</p>"},{"location":"api/transport/#imports","title":"Imports","text":"<pre><code>from cook.transport import LocalTransport, NullTransport\n</code></pre>"},{"location":"examples/minimidia/","title":"Minimidia SaaS Infrastructure","text":"<p>Complete production infrastructure for a Node.js SaaS application.</p>"},{"location":"examples/minimidia/#overview","title":"Overview","text":"<p>This example demonstrates a production-ready deployment including:</p> <ul> <li>System updates and package management</li> <li>Third-party repository setup (NodeSource, Docker)</li> <li>Web server (Nginx) with reverse proxy</li> <li>Application server (Node.js with systemd)</li> <li>TLS certificates (Let's Encrypt)</li> <li>Database (SQLite)</li> <li>Container platform (Docker)</li> <li>Security hardening</li> </ul>"},{"location":"examples/minimidia/#architecture","title":"Architecture","text":"<pre><code>Internet\n   |\n   v\n[Nginx :80/443] --- TLS Termination\n   |\n   | Reverse Proxy\n   v\n[Node.js :3000] --- Application Server\n   |\n   v\n[SQLite] --- Database\n</code></pre>"},{"location":"examples/minimidia/#configuration","title":"Configuration","text":"<p>File: <code>examples/minimidia.py</code></p> <pre><code>from cook import File, Package, Service, Exec, Repository\nimport os\n\nDOMAIN = os.getenv(\"DOMAIN\", \"minimidia.com\")\nAPP_DIR = \"/opt/apps/minimidia\"\nAPP_PORT = 3000\n\n# System updates\nRepository(\"apt-update\", action=\"update\")\nRepository(\"apt-upgrade\", action=\"upgrade\")\n\n# Add repositories\nRepository(\n    \"nodesource\",\n    action=\"add\",\n    repo=\"deb https://deb.nodesource.com/node_20.x nodistro main\",\n    key_url=\"https://deb.nodesource.com/gpgkey/nodesource.gpg.key\"\n)\n\nRepository(\n    \"docker\",\n    action=\"add\",\n    repo=\"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\",\n    key_url=\"https://download.docker.com/linux/ubuntu/gpg\"\n)\n\nRepository(\"apt-update-post\", action=\"update\")\n\n# Install packages\nPackage(\"nginx\")\nPackage(\"nodejs\")\nPackage(\"certbot\", packages=[\"certbot\", \"python3-certbot-nginx\"])\nPackage(\"docker\", packages=[\"docker-ce\", \"docker-ce-cli\", \"containerd.io\"])\nPackage(\"sqlite\", packages=[\"sqlite3\", \"libsqlite3-dev\"])\n\n# Application structure\nFile(APP_DIR, ensure=\"directory\", mode=0o755)\nFile(f\"{APP_DIR}/data\", ensure=\"directory\", mode=0o750, owner=\"www-data\")\n\n# Systemd service\nFile(\"/etc/systemd/system/minimidia.service\",\n     source=\"./minimidia.service\",\n     mode=0o644)\n\nService(\"minimidia\", running=True, enabled=True)\n\n# Nginx configuration\nnginx_conf = File(f\"/etc/nginx/sites-available/{DOMAIN}\",\n                  template=\"./nginx.conf.j2\",\n                  vars={\"domain\": DOMAIN, \"port\": APP_PORT})\n\nService(\"nginx\", running=True, enabled=True, reload_on=[nginx_conf])\n\n# TLS certificate\nExec(\"certbot\",\n     command=f\"certbot certonly --nginx -d {DOMAIN} --non-interactive --agree-tos -m admin@{DOMAIN}\",\n     creates=f\"/etc/letsencrypt/live/{DOMAIN}/fullchain.pem\")\n</code></pre>"},{"location":"examples/minimidia/#deployment","title":"Deployment","text":""},{"location":"examples/minimidia/#prerequisites","title":"Prerequisites","text":"<ul> <li>Ubuntu 22.04 or later</li> <li>Root access or sudo privileges</li> <li>Domain name pointing to server</li> </ul>"},{"location":"examples/minimidia/#environment-variables","title":"Environment Variables","text":"<pre><code>export DOMAIN=minimidia.com\nexport ADMIN_EMAIL=admin@minimidia.com\n</code></pre>"},{"location":"examples/minimidia/#deploy","title":"Deploy","text":"<pre><code># Plan deployment\nsudo cook plan examples/minimidia.py\n\n# Apply configuration\nsudo cook apply examples/minimidia.py --yes\n</code></pre>"},{"location":"examples/minimidia/#verify","title":"Verify","text":"<pre><code># Check services\nsudo systemctl status minimidia\nsudo systemctl status nginx\n\n# Test application\ncurl https://minimidia.com/health\n\n# View logs\nsudo journalctl -u minimidia -f\n</code></pre>"},{"location":"examples/minimidia/#multi-environment-deployment","title":"Multi-Environment Deployment","text":"<p>File: <code>examples/minimidia-env.py</code></p> <p>Supports development, staging, and production environments:</p> <pre><code># Development\nsudo COOK_ENV=development cook apply examples/minimidia-env.py --yes\n\n# Staging\nsudo COOK_ENV=staging DOMAIN=staging.minimidia.com cook apply examples/minimidia-env.py --yes\n\n# Production\nsudo COOK_ENV=production DOMAIN=minimidia.com cook apply examples/minimidia-env.py --yes\n</code></pre>"},{"location":"examples/minimidia/#environment-differences","title":"Environment Differences","text":"Feature Development Staging Production SSL/TLS Disabled Let's Encrypt Staging Let's Encrypt Production Auto-restart No Yes Yes Log level debug info warn Firewall Optional Enabled Enabled Log rotation 7 days 14 days 30 days"},{"location":"examples/minimidia/#components","title":"Components","text":""},{"location":"examples/minimidia/#application-server","title":"Application Server","text":"<p>Node.js application with Express framework:</p> <ul> <li>Port: 3000 (localhost only)</li> <li>Database: SQLite</li> <li>User: www-data</li> <li>Systemd managed</li> </ul>"},{"location":"examples/minimidia/#web-server","title":"Web Server","text":"<p>Nginx reverse proxy:</p> <ul> <li>HTTP: Redirect to HTTPS</li> <li>HTTPS: TLS 1.2+</li> <li>Headers: Security headers enabled</li> <li>Logs: <code>/var/log/nginx/</code></li> </ul>"},{"location":"examples/minimidia/#database","title":"Database","text":"<p>SQLite database:</p> <ul> <li>Location: <code>/opt/apps/minimidia/data/minimidia.db</code></li> <li>Owner: www-data</li> <li>Backups: Manual (recommended: daily cron)</li> </ul>"},{"location":"examples/minimidia/#tls-certificates","title":"TLS Certificates","text":"<p>Let's Encrypt via certbot:</p> <ul> <li>Auto-renewal: certbot.timer (systemd)</li> <li>Certificate: <code>/etc/letsencrypt/live/{domain}/</code></li> <li>Renewal: Automatic every 60 days</li> </ul>"},{"location":"examples/minimidia/#security-features","title":"Security Features","text":""},{"location":"examples/minimidia/#systemd-hardening","title":"Systemd Hardening","text":"<pre><code>[Service]\nNoNewPrivileges=true\nPrivateTmp=true\nProtectSystem=strict\nProtectHome=true\nReadWritePaths=/opt/apps/minimidia/data\n</code></pre>"},{"location":"examples/minimidia/#nginx-security-headers","title":"Nginx Security Headers","text":"<pre><code>add_header Strict-Transport-Security \"max-age=31536000\";\nadd_header X-Frame-Options \"SAMEORIGIN\";\nadd_header X-Content-Type-Options \"nosniff\";\n</code></pre>"},{"location":"examples/minimidia/#firewall-rules","title":"Firewall Rules","text":"<pre><code>Exec(\"ufw-ssh\", command=\"ufw allow 22/tcp\")\nExec(\"ufw-http\", command=\"ufw allow 80/tcp\")\nExec(\"ufw-https\", command=\"ufw allow 443/tcp\")\n</code></pre>"},{"location":"examples/minimidia/#maintenance","title":"Maintenance","text":""},{"location":"examples/minimidia/#update-application","title":"Update Application","text":"<pre><code># Pull latest code\ncd /opt/apps/minimidia\ngit pull\n\n# Install dependencies\nnpm install --production\n\n# Restart service\nsudo systemctl restart minimidia\n</code></pre>"},{"location":"examples/minimidia/#check-drift","title":"Check Drift","text":"<p>Detect configuration drift:</p> <pre><code>sudo cook check-drift\n</code></pre> <p>Fix drift:</p> <pre><code>sudo cook check-drift --fix\n</code></pre>"},{"location":"examples/minimidia/#certificate-renewal","title":"Certificate Renewal","text":"<p>Test renewal:</p> <pre><code>sudo certbot renew --dry-run\n</code></pre> <p>Manual renewal:</p> <pre><code>sudo certbot renew\n</code></pre>"},{"location":"examples/minimidia/#logs","title":"Logs","text":"<p>Application logs:</p> <pre><code>sudo journalctl -u minimidia -f\n</code></pre> <p>Nginx logs:</p> <pre><code>sudo tail -f /var/log/nginx/minimidia.com-access.log\nsudo tail -f /var/log/nginx/minimidia.com-error.log\n</code></pre>"},{"location":"examples/minimidia/#troubleshooting","title":"Troubleshooting","text":""},{"location":"examples/minimidia/#application-wont-start","title":"Application Won't Start","text":"<p>Check logs:</p> <pre><code>sudo journalctl -u minimidia -n 50\n</code></pre> <p>Check permissions:</p> <pre><code>ls -la /opt/apps/minimidia\n</code></pre>"},{"location":"examples/minimidia/#nginx-502-bad-gateway","title":"Nginx 502 Bad Gateway","text":"<p>Verify application is running:</p> <pre><code>curl http://127.0.0.1:3000/health\n</code></pre> <p>Check Nginx config:</p> <pre><code>sudo nginx -t\n</code></pre>"},{"location":"examples/minimidia/#certificate-issues","title":"Certificate Issues","text":"<p>Check certificate status:</p> <pre><code>sudo certbot certificates\n</code></pre> <p>Renew manually:</p> <pre><code>sudo certbot renew --force-renewal\n</code></pre>"},{"location":"examples/minimidia/#reference","title":"Reference","text":"<ul> <li>Repository Resource</li> <li>Package Resource</li> <li>Service Resource</li> <li>File Resource</li> <li>Exec Resource</li> </ul>"},{"location":"getting-started/concepts/","title":"Core Concepts","text":"<p>Cook is built around a few core concepts that make configuration management predictable and testable.</p>"},{"location":"getting-started/concepts/#resources","title":"Resources","text":"<p>Resources represent desired system state. Each resource type manages a specific aspect of the system.</p>"},{"location":"getting-started/concepts/#check-plan-apply-pattern","title":"Check-Plan-Apply Pattern","text":"<p>Cook uses a three-phase execution model:</p> <ol> <li>Check: Inspect current system state</li> <li>Plan: Compare current to desired state</li> <li>Apply: Execute changes to reach desired state</li> </ol> <p>This pattern enables:</p> <ul> <li>Dry-run mode (plan without apply)</li> <li>Drift detection</li> <li>Predictable changes</li> </ul>"},{"location":"getting-started/concepts/#idempotency","title":"Idempotency","text":"<p>Resources are idempotent. Running the same configuration multiple times produces the same result.</p>"},{"location":"getting-started/concepts/#transport","title":"Transport","text":"<p>Transport abstracts local vs remote execution. The same configuration works locally or over SSH.</p>"},{"location":"getting-started/concepts/#state-tracking","title":"State Tracking","text":"<p>Optional state persistence enables:</p> <ul> <li>Resource history</li> <li>Drift detection</li> <li>Change auditing</li> </ul>"},{"location":"getting-started/concepts/#platform-detection","title":"Platform Detection","text":"<p>Cook automatically detects the operating system and adjusts behavior accordingly.</p>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.8 or higher</li> <li>Linux or macOS operating system</li> <li>pip or uv package manager</li> </ul>"},{"location":"getting-started/installation/#using-uv-recommended","title":"Using uv (Recommended)","text":"<p>uv is a fast Python package installer and resolver.</p> <pre><code># Install uv\ncurl -LsSf https://astral.sh/uv/install.sh | sh\n\n# Clone repository\ngit clone https://github.com/gleicon/cook\ncd cook\n\n# Create virtual environment and install\nuv venv\nuv pip install -e \".[all]\"\nsource .venv/bin/activate\n</code></pre>"},{"location":"getting-started/installation/#using-pip","title":"Using pip","text":"<pre><code># Clone repository\ngit clone https://github.com/gleicon/cook\ncd cook\n\n# Create virtual environment\npython3 -m venv .venv\nsource .venv/bin/activate\n\n# Install with all features\npip install -e \".[all]\"\n</code></pre>"},{"location":"getting-started/installation/#install-options","title":"Install Options","text":"<p>Cook has optional feature sets:</p>"},{"location":"getting-started/installation/#minimal-installation","title":"Minimal Installation","text":"<p>Core functionality only:</p> <pre><code>pip install -e .\n</code></pre>"},{"location":"getting-started/installation/#specific-features","title":"Specific Features","text":"<p>Install only what you need:</p> <pre><code># Templates support (Jinja2)\npip install -e \".[templates]\"\n\n# SSH remote execution\npip install -e \".[ssh]\"\n\n# State persistence\npip install -e \".[state]\"\n\n# Recording mode\npip install -e \".[record]\"\n\n# All features\npip install -e \".[all]\"\n</code></pre>"},{"location":"getting-started/installation/#development-installation","title":"Development Installation","text":"<p>For development and testing:</p> <pre><code>pip install -e \".[all,dev,docs]\"\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code>cook --version\n</code></pre> <p>Expected output:</p> <pre><code>cook, version 0.1.0\n</code></pre>"},{"location":"getting-started/installation/#platform-specific-notes","title":"Platform-Specific Notes","text":""},{"location":"getting-started/installation/#ubuntudebian","title":"Ubuntu/Debian","text":"<p>Some features require system packages:</p> <pre><code>sudo apt-get install python3-dev libsqlite3-dev\n</code></pre>"},{"location":"getting-started/installation/#macos","title":"macOS","text":"<p>Homebrew Python is recommended:</p> <pre><code>brew install python@3.11\n</code></pre>"},{"location":"getting-started/installation/#arch-linux","title":"Arch Linux","text":"<pre><code>sudo pacman -S python python-pip\n</code></pre>"},{"location":"getting-started/installation/#see-also","title":"See also","text":"<ul> <li>Quick Start Guide</li> <li>Core Concepts</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This guide walks through creating your first Cook configuration.</p>"},{"location":"getting-started/quickstart/#your-first-configuration","title":"Your First Configuration","text":"<p>Create a file named <code>server.py</code>:</p> <pre><code>from cook import File, Package, Service\n\n# Install nginx\nPackage(\"nginx\")\n\n# Configure nginx\nFile(\"/etc/nginx/nginx.conf\",\n     content=\"\"\"\n     events { worker_connections 1024; }\n     http {\n         server {\n             listen 80;\n             location / {\n                 return 200 'Hello from Cook';\n             }\n         }\n     }\n     \"\"\",\n     mode=0o644)\n\n# Ensure nginx is running\nService(\"nginx\", running=True, enabled=True)\n</code></pre>"},{"location":"getting-started/quickstart/#preview-changes","title":"Preview Changes","text":"<p>See what Cook will do without making changes:</p> <pre><code>sudo cook plan server.py\n</code></pre> <p>Output:</p> <pre><code>Planning resources...\n\n[Package] nginx\n  Action: create\n  Changes:\n    type: None \u2192 nginx\n\n[File] /etc/nginx/nginx.conf\n  Action: create\n  Changes:\n    content: None \u2192 &lt;content&gt;\n    mode: None \u2192 0o644\n\n[Service] nginx\n  Action: update\n  Changes:\n    running: False \u2192 True\n    enabled: False \u2192 True\n\nSummary: 3 resources, 3 changes\n</code></pre>"},{"location":"getting-started/quickstart/#apply-configuration","title":"Apply Configuration","text":"<p>Execute the changes:</p> <pre><code>sudo cook apply server.py\n</code></pre> <p>Output:</p> <pre><code>Applying changes...\n\n[Package] nginx: Installing\n[File] /etc/nginx/nginx.conf: Creating\n[Service] nginx: Starting and enabling\n\nComplete: 3 resources applied successfully\n</code></pre>"},{"location":"getting-started/quickstart/#verify","title":"Verify","text":"<p>Check that nginx is running:</p> <pre><code>curl http://localhost\n</code></pre> <p>Expected output:</p> <pre><code>Hello from Cook\n</code></pre>"},{"location":"getting-started/quickstart/#idempotency","title":"Idempotency","text":"<p>Run apply again:</p> <pre><code>sudo cook plan server.py\n</code></pre> <p>Output:</p> <pre><code>No changes needed\n</code></pre> <p>Cook detects that the system already matches the desired state.</p>"},{"location":"getting-started/quickstart/#make-changes","title":"Make Changes","text":"<p>Edit <code>server.py</code> to change the response:</p> <pre><code>File(\"/etc/nginx/nginx.conf\",\n     content=\"\"\"\n     events { worker_connections 1024; }\n     http {\n         server {\n             listen 80;\n             location / {\n                 return 200 'Updated response';\n             }\n         }\n     }\n     \"\"\",\n     mode=0o644)\n</code></pre> <p>Plan and apply:</p> <pre><code>sudo cook plan server.py\nsudo cook apply server.py\n</code></pre> <p>Cook updates only the changed file and reloads nginx.</p>"},{"location":"getting-started/quickstart/#see-also","title":"See also","text":"<ul> <li>Core Concepts</li> <li>Resource Reference</li> <li>Examples</li> </ul>"},{"location":"resources/","title":"Resources Overview","text":"<p>Resources are the fundamental building blocks in Cook. Each resource represents a desired state of a system component.</p>"},{"location":"resources/#resource-types","title":"Resource Types","text":"<p>Cook provides five core resource types:</p>"},{"location":"resources/#file","title":"File","text":"<p>Manage files, directories, and templates.</p> <pre><code>File(\"/etc/app/config.json\",\n     content='{\"port\": 8080}',\n     mode=0o644,\n     owner=\"app\",\n     group=\"app\")\n</code></pre> <p>Use for:</p> <ul> <li>Configuration files</li> <li>Directory structures</li> <li>File permissions</li> <li>Template rendering (Jinja2)</li> </ul>"},{"location":"resources/#package","title":"Package","text":"<p>Install and manage system packages.</p> <pre><code>Package(\"nginx\")\n\nPackage(\"dev-tools\", packages=[\n    \"git\",\n    \"curl\",\n    \"vim\"\n])\n</code></pre> <p>Use for:</p> <ul> <li>Installing software</li> <li>Managing package versions</li> <li>Removing packages</li> </ul>"},{"location":"resources/#repository","title":"Repository","text":"<p>Manage package repositories and system updates.</p> <pre><code>Repository(\"apt-update\", action=\"update\")\nRepository(\"apt-upgrade\", action=\"upgrade\")\n\nRepository(\"docker\",\n           repo=\"deb https://download.docker.com/linux/ubuntu focal stable\",\n           key_url=\"https://download.docker.com/linux/ubuntu/gpg\")\n</code></pre> <p>Use for:</p> <ul> <li>Updating package cache</li> <li>System upgrades</li> <li>Adding third-party repositories</li> <li>Managing GPG keys</li> </ul>"},{"location":"resources/#service","title":"Service","text":"<p>Control system services.</p> <pre><code>Service(\"nginx\",\n        running=True,\n        enabled=True)\n</code></pre> <p>Use for:</p> <ul> <li>Starting/stopping services</li> <li>Enabling services at boot</li> <li>Service reload triggers</li> </ul>"},{"location":"resources/#exec","title":"Exec","text":"<p>Execute commands with idempotency guards.</p> <pre><code>Exec(\"setup-database\",\n     command=\"mysql &lt; /tmp/schema.sql\",\n     creates=\"/var/lib/mysql/app_db\")\n</code></pre> <p>Use for:</p> <ul> <li>One-time setup commands</li> <li>Conditional execution</li> <li>Custom operations</li> </ul>"},{"location":"resources/#resource-pattern","title":"Resource Pattern","text":"<p>All resources follow the Check-Plan-Apply pattern:</p>"},{"location":"resources/#check","title":"Check","text":"<p>Inspect current system state.</p> <pre><code>resource.check(platform)\n# Returns: {\"exists\": True, \"content\": \"...\", ...}\n</code></pre>"},{"location":"resources/#plan","title":"Plan","text":"<p>Compare current state to desired state.</p> <pre><code>plan = resource.plan(platform)\n# Returns: Plan(action=Action.UPDATE, changes=[...])\n</code></pre>"},{"location":"resources/#apply","title":"Apply","text":"<p>Execute changes to reach desired state.</p> <pre><code>resource.apply(plan, platform)\n</code></pre>"},{"location":"resources/#common-parameters","title":"Common Parameters","text":"<p>Most resources support these parameters:</p> <p>name</p> <p>Resource identifier. Must be unique within resource type.</p> <pre><code>Package(\"nginx\")  # name=\"nginx\"\n</code></pre> <p>ensure</p> <p>Desired state: \"present\" or \"absent\"</p> <pre><code>Package(\"apache2\", ensure=\"absent\")\n</code></pre>"},{"location":"resources/#resource-registration","title":"Resource Registration","text":"<p>Resources automatically register with the global executor:</p> <pre><code>from cook import Package\n\n# Automatically registered\nPackage(\"nginx\")\nPackage(\"curl\")\n</code></pre> <p>Access registered resources:</p> <pre><code>from cook.core.executor import get_executor\n\nexecutor = get_executor()\nresources = executor.list_resources()\n</code></pre>"},{"location":"resources/#dependencies","title":"Dependencies","text":"<p>Resources execute in registration order. Use explicit ordering for dependencies:</p> <pre><code># Install nginx first\nPackage(\"nginx\")\n\n# Then configure\nnginx_conf = File(\"/etc/nginx/nginx.conf\", source=\"./nginx.conf\")\n\n# Then start with reload trigger\nService(\"nginx\",\n        running=True,\n        enabled=True,\n        reload_on=[nginx_conf])\n</code></pre>"},{"location":"resources/#platform-detection","title":"Platform Detection","text":"<p>Resources adapt to the platform automatically:</p> <pre><code>from cook.core import Platform\n\nplatform = Platform.detect()\n# Platform(system='Linux', distro='ubuntu', version='22.04', arch='x86_64')\n</code></pre> <p>Supported platforms:</p> <ul> <li>Ubuntu/Debian (apt)</li> <li>Fedora/RHEL (dnf)</li> <li>Arch Linux (pacman)</li> <li>macOS (brew, launchctl)</li> </ul>"},{"location":"resources/#error-handling","title":"Error Handling","text":"<p>Resources raise exceptions on failure:</p> <pre><code>try:\n    from cook.core.executor import Executor\n    executor = Executor()\n    result = executor.apply()\nexcept RuntimeError as e:\n    print(f\"Apply failed: {e}\")\n</code></pre>"},{"location":"resources/#state-tracking","title":"State Tracking","text":"<p>Enable state persistence:</p> <pre><code>from cook.core.executor import Executor\n\nexecutor = Executor()\nexecutor.enable_state_tracking()\n\n# State stored in SQLite database\n</code></pre>"},{"location":"resources/#resource-reference","title":"Resource Reference","text":"<p>Detailed documentation for each resource type:</p> <ul> <li>File Resource</li> <li>Package Resource</li> <li>Repository Resource</li> <li>Service Resource</li> <li>Exec Resource</li> </ul>"},{"location":"resources/exec/","title":"Exec Resource","text":"<p>Execute arbitrary commands with idempotency guards and security validation.</p>"},{"location":"resources/exec/#overview","title":"Overview","text":"<p>The Exec resource runs shell commands:</p> <ul> <li>Execute commands with idempotency guards</li> <li>Conditional execution (creates, unless, only_if)</li> <li>Environment variables and working directory</li> <li>Security validation for command injection</li> <li>Dry-run mode for safe testing</li> <li>Command change tracking</li> </ul>"},{"location":"resources/exec/#security","title":"Security","text":"<p>IMPORTANT: Exec runs commands via shell. Enable security validation to prevent command injection.</p>"},{"location":"resources/exec/#safe-by-default","title":"Safe by Default","text":"<p>Security validation is enabled by default:</p> <pre><code>from cook import Exec\n\n# Safe mode enabled automatically\nExec(\"backup\", command=\"tar czf /backup/data.tar.gz /var/data\")\n</code></pre>"},{"location":"resources/exec/#security-levels","title":"Security Levels","text":"Level Behavior <code>strict</code> Block dangerous patterns (default) <code>warn</code> Warn but allow dangerous patterns <code>none</code> No validation (dangerous) <pre><code># Strict mode (default)\nExec(\"backup\", command=\"tar czf /backup/data.tar.gz /var/data\", security_level=\"strict\")\n\n# Warning mode\nExec(\"backup\", command=\"tar czf /backup/data.tar.gz /var/data\", security_level=\"warn\")\n\n# No validation (use with extreme caution)\nExec(\"backup\", command=\"tar czf /backup/data.tar.gz /var/data\", security_level=\"none\")\n</code></pre>"},{"location":"resources/exec/#basic-usage","title":"Basic Usage","text":""},{"location":"resources/exec/#simple-command","title":"Simple Command","text":"<pre><code>from cook import Exec\n\nExec(\"update-cache\", command=\"apt-get update\")\n</code></pre>"},{"location":"resources/exec/#idempotent-execution","title":"Idempotent Execution","text":"<p>Use guards to make commands idempotent:</p> <pre><code># Run only if file doesn't exist\nExec(\n    \"download-installer\",\n    command=\"curl -o /tmp/installer.sh https://example.com/install.sh\",\n    creates=\"/tmp/installer.sh\"\n)\n</code></pre>"},{"location":"resources/exec/#conditional-execution","title":"Conditional Execution","text":"<pre><code># Run only if condition fails\nExec(\n    \"install-composer\",\n    command=\"curl -sS https://getcomposer.org/installer | php\",\n    unless=\"which composer\"\n)\n\n# Run only if condition succeeds\nExec(\n    \"setup-database\",\n    command=\"mysql &lt; /tmp/schema.sql\",\n    only_if=\"systemctl is-active mysql\"\n)\n</code></pre>"},{"location":"resources/exec/#parameters","title":"Parameters","text":""},{"location":"resources/exec/#name","title":"name","text":"<p>Required. Resource identifier and description.</p> <pre><code>Exec(\"backup-database\", command=\"...\")\n</code></pre>"},{"location":"resources/exec/#command","title":"command","text":"<p>Required. Shell command to execute.</p> <pre><code>Exec(\"update\", command=\"apt-get update\")\n</code></pre>"},{"location":"resources/exec/#creates","title":"creates","text":"<p>Only run command if this file or directory does not exist.</p> <pre><code>Exec(\n    \"create-database\",\n    command=\"createdb myapp\",\n    creates=\"/var/lib/postgresql/data/myapp\"\n)\n</code></pre> <p>After first run, file exists, command will not run again.</p>"},{"location":"resources/exec/#unless","title":"unless","text":"<p>Only run command if this guard command fails (returns non-zero exit code).</p> <pre><code>Exec(\n    \"install-nodejs\",\n    command=\"curl -fsSL https://deb.nodesource.com/setup_20.x | bash -\",\n    unless=\"which node\"\n)\n</code></pre> <p>If <code>which node</code> succeeds (node installed), command does not run.</p>"},{"location":"resources/exec/#only_if","title":"only_if","text":"<p>Only run command if this guard command succeeds (returns zero exit code).</p> <pre><code>Exec(\n    \"restart-app\",\n    command=\"systemctl restart myapp\",\n    only_if=\"systemctl is-active myapp\"\n)\n</code></pre> <p>Only restarts if service is currently active.</p>"},{"location":"resources/exec/#cwd","title":"cwd","text":"<p>Working directory for command execution.</p> <pre><code>Exec(\n    \"build-app\",\n    command=\"npm run build\",\n    cwd=\"/opt/apps/myapp\"\n)\n</code></pre> <p>Equivalent to:</p> <pre><code>cd /opt/apps/myapp &amp;&amp; npm run build\n</code></pre>"},{"location":"resources/exec/#environment","title":"environment","text":"<p>Environment variables for command.</p> <pre><code>Exec(\n    \"deploy\",\n    command=\"./deploy.sh\",\n    environment={\n        \"ENVIRONMENT\": \"production\",\n        \"API_KEY\": \"secret-key\"\n    }\n)\n</code></pre>"},{"location":"resources/exec/#dry_run","title":"dry_run","text":"<p>Preview mode. Shows what would be executed without running the command.</p> <pre><code>Exec(\n    \"deploy\",\n    command=\"./deploy.sh\",\n    dry_run=True\n)\n</code></pre>"},{"location":"resources/exec/#safe_mode","title":"safe_mode","text":"<p>Enable security validation. Default: <code>True</code>.</p> <p>Recommended: Keep enabled unless you have a specific reason to disable it.</p> <pre><code># Safe mode enabled (default)\nExec(\"backup\", command=\"tar czf /backup/data.tar.gz /var/data\")\n\n# Disable with extreme caution\nExec(\"backup\", command=\"tar czf /backup/data.tar.gz /var/data\", safe_mode=False)\n</code></pre>"},{"location":"resources/exec/#allow_pipes","title":"allow_pipes","text":"<p>Allow pipe character (|) in commands. Default: <code>True</code>.</p> <pre><code>Exec(\n    \"process-logs\",\n    command=\"cat /var/log/app.log | grep ERROR\",\n    allow_pipes=True\n)\n</code></pre>"},{"location":"resources/exec/#allow_redirects","title":"allow_redirects","text":"<p>Allow redirect characters (&gt;, &lt;) in commands. Default: <code>True</code>.</p> <pre><code>Exec(\n    \"save-output\",\n    command=\"echo 'data' &gt; /tmp/output.txt\",\n    allow_redirects=True\n)\n</code></pre>"},{"location":"resources/exec/#idempotency-guards","title":"Idempotency Guards","text":"<p>Use guards to ensure commands run only when needed.</p>"},{"location":"resources/exec/#creates-guard","title":"creates Guard","text":"<p>Run only if file does not exist:</p> <pre><code>Exec(\n    \"download-file\",\n    command=\"curl -o /tmp/data.json https://api.example.com/data\",\n    creates=\"/tmp/data.json\"\n)\n# First run: Downloads file\n# Second run: File exists, skips download\n</code></pre>"},{"location":"resources/exec/#unless-guard","title":"unless Guard","text":"<p>Run only if guard command fails:</p> <pre><code>Exec(\n    \"install-docker\",\n    command=\"curl -fsSL https://get.docker.com | sh\",\n    unless=\"which docker\"\n)\n# If docker not installed: Runs installer\n# If docker installed: Skips installation\n</code></pre>"},{"location":"resources/exec/#only_if-guard","title":"only_if Guard","text":"<p>Run only if guard command succeeds:</p> <pre><code>Exec(\n    \"backup-database\",\n    command=\"pg_dump myapp &gt; /backup/myapp.sql\",\n    only_if=\"systemctl is-active postgresql\"\n)\n# Only runs if PostgreSQL is active\n</code></pre>"},{"location":"resources/exec/#combining-guards","title":"Combining Guards","text":"<pre><code>Exec(\n    \"setup-database\",\n    command=\"mysql &lt; /tmp/schema.sql\",\n    creates=\"/var/lib/mysql/myapp/users.frm\",\n    only_if=\"systemctl is-active mysql\"\n)\n# Runs only if:\n# 1. MySQL is active (only_if)\n# 2. Table file doesn't exist (creates)\n</code></pre>"},{"location":"resources/exec/#examples","title":"Examples","text":""},{"location":"resources/exec/#system-setup-commands","title":"System Setup Commands","text":"<pre><code>from cook import Exec\n\n# Update package cache\nExec(\"apt-update\", command=\"apt-get update\")\n\n# Set timezone\nExec(\n    \"set-timezone\",\n    command=\"timedatectl set-timezone America/New_York\",\n    unless=\"timedatectl | grep 'America/New_York'\"\n)\n\n# Set hostname\nExec(\n    \"set-hostname\",\n    command=\"hostnamectl set-hostname webserver01\",\n    unless=\"hostname | grep webserver01\"\n)\n</code></pre>"},{"location":"resources/exec/#download-and-install","title":"Download and Install","text":"<pre><code># Download installer\nExec(\n    \"download-installer\",\n    command=\"curl -fsSL https://get.docker.com -o /tmp/get-docker.sh\",\n    creates=\"/tmp/get-docker.sh\"\n)\n\n# Run installer\nExec(\n    \"install-docker\",\n    command=\"sh /tmp/get-docker.sh\",\n    unless=\"which docker\"\n)\n</code></pre>"},{"location":"resources/exec/#database-operations","title":"Database Operations","text":"<pre><code># Create database\nExec(\n    \"create-database\",\n    command=\"createdb myapp\",\n    creates=\"/var/lib/postgresql/data/myapp\",\n    only_if=\"systemctl is-active postgresql\"\n)\n\n# Import schema\nExec(\n    \"import-schema\",\n    command=\"psql myapp &lt; /tmp/schema.sql\",\n    unless=\"psql myapp -c '\\\\dt' | grep users\"\n)\n\n# Create database user\nExec(\n    \"create-db-user\",\n    command=\"createuser -P myapp_user\",\n    unless=\"psql -c '\\\\du' | grep myapp_user\"\n)\n</code></pre>"},{"location":"resources/exec/#ssl-certificates","title":"SSL Certificates","text":"<pre><code>from cook import Exec\nimport os\n\ndomain = os.getenv(\"DOMAIN\", \"example.com\")\nemail = os.getenv(\"ADMIN_EMAIL\", \"admin@example.com\")\n\n# Obtain Let's Encrypt certificate\nExec(\n    \"certbot-obtain\",\n    command=f\"certbot certonly --nginx -d {domain} --non-interactive --agree-tos -m {email}\",\n    creates=f\"/etc/letsencrypt/live/{domain}/fullchain.pem\"\n)\n</code></pre>"},{"location":"resources/exec/#application-deployment","title":"Application Deployment","text":"<pre><code>from cook import Exec, File\n\n# Application directory\nFile(\"/opt/apps/myapp\", ensure=\"directory\")\n\n# Clone repository\nExec(\n    \"clone-repo\",\n    command=\"git clone https://github.com/user/myapp.git /opt/apps/myapp\",\n    creates=\"/opt/apps/myapp/.git\"\n)\n\n# Install dependencies\nExec(\n    \"install-deps\",\n    command=\"npm install --production\",\n    cwd=\"/opt/apps/myapp\",\n    unless=\"test -d /opt/apps/myapp/node_modules\"\n)\n\n# Build application\nExec(\n    \"build-app\",\n    command=\"npm run build\",\n    cwd=\"/opt/apps/myapp\",\n    environment={\"NODE_ENV\": \"production\"}\n)\n</code></pre>"},{"location":"resources/exec/#docker-operations","title":"Docker Operations","text":"<pre><code># Pull Docker image\nExec(\n    \"pull-image\",\n    command=\"docker pull nginx:latest\",\n    unless=\"docker image inspect nginx:latest\"\n)\n\n# Run container\nExec(\n    \"run-container\",\n    command=\"docker run -d --name web -p 80:80 nginx\",\n    unless=\"docker ps | grep web\"\n)\n\n# Docker Compose\nExec(\n    \"compose-up\",\n    command=\"docker-compose up -d\",\n    cwd=\"/opt/apps/myapp\",\n    creates=\"/opt/apps/myapp/.deployed\"\n)\n</code></pre>"},{"location":"resources/exec/#systemd-daemon-reload","title":"Systemd Daemon Reload","text":"<pre><code>from cook import File, Exec\n\n# Create service file\nservice_file = File(\n    \"/etc/systemd/system/myapp.service\",\n    source=\"./myapp.service\"\n)\n\n# Reload systemd after service file changes\nExec(\n    \"systemd-reload\",\n    command=\"systemctl daemon-reload\"\n)\n</code></pre>"},{"location":"resources/exec/#security-considerations","title":"Security Considerations","text":""},{"location":"resources/exec/#command-injection-prevention","title":"Command Injection Prevention","text":"<p>Security validation blocks dangerous patterns:</p> <p>Blocked Patterns: - Command chaining: <code>;</code>, <code>&amp;&amp;</code>, <code>||</code> - Command substitution: <code>$(...)</code>, <code>`...`</code> - Variable expansion: <code>${...}</code> - Newline injection: <code>\\n</code>, <code>\\r</code></p> <p>Allowed with Flags: - Pipes: <code>|</code> (allowed if <code>allow_pipes=True</code>) - Redirects: <code>&gt;</code>, <code>&lt;</code> (allowed if <code>allow_redirects=True</code>)</p>"},{"location":"resources/exec/#safe-commands","title":"Safe Commands","text":"<pre><code># Safe: Static paths, no user input\nExec(\"backup\", command=\"tar czf /backup/data.tar.gz /var/data\")\n\n# Safe: Using creates guard\nExec(\n    \"download\",\n    command=\"curl -o /tmp/file.tar.gz https://example.com/file.tar.gz\",\n    creates=\"/tmp/file.tar.gz\"\n)\n</code></pre>"},{"location":"resources/exec/#unsafe-commands","title":"Unsafe Commands","text":"<pre><code># UNSAFE: User input in command\nuser_file = input()  # User input!\nExec(\"backup\", command=f\"tar czf /backup/{user_file}\")  # DANGEROUS!\n\n# UNSAFE: Shell variable expansion\nExec(\"delete\", command=\"rm -rf $TEMP_DIR\")  # Variable could be anything!\n</code></pre>"},{"location":"resources/exec/#environment-variables","title":"Environment Variables","text":"<p>Use environment parameter instead of embedding in command:</p> <pre><code># Good: Environment variables passed separately\nExec(\n    \"deploy\",\n    command=\"./deploy.sh\",\n    environment={\"API_KEY\": \"secret\"}\n)\n\n# Avoid: Environment variables in command\nExec(\"deploy\", command=\"API_KEY=secret ./deploy.sh\")\n</code></pre>"},{"location":"resources/exec/#dangerous-commands","title":"Dangerous Commands","text":"<p>Security validation warns about:</p> <ul> <li><code>rm -rf /</code> - Recursive delete from root</li> <li><code>dd if=/dev/</code> - Disk operations</li> <li><code>mkfs.</code> - Format filesystem</li> <li><code>chmod 777</code> - World-writable permissions</li> <li><code>curl ... | bash</code> - Pipe to shell</li> <li><code>eval</code> - Code evaluation</li> </ul>"},{"location":"resources/exec/#dry-run-testing","title":"Dry Run Testing","text":"<p>Test commands safely with dry-run mode:</p> <pre><code># Test without executing\nExec(\n    \"deploy\",\n    command=\"./deploy.sh\",\n    dry_run=True\n)\n# Shows what would be executed, but doesn't run it\n</code></pre>"},{"location":"resources/exec/#working-directory-and-environment","title":"Working Directory and Environment","text":""},{"location":"resources/exec/#change-working-directory","title":"Change Working Directory","text":"<pre><code>Exec(\n    \"build\",\n    command=\"npm run build\",\n    cwd=\"/opt/apps/myapp\"\n)\n</code></pre> <p>Equivalent to:</p> <pre><code>cd /opt/apps/myapp &amp;&amp; npm run build\n</code></pre>"},{"location":"resources/exec/#set-environment-variables","title":"Set Environment Variables","text":"<pre><code>Exec(\n    \"compile\",\n    command=\"gcc -o app main.c\",\n    environment={\n        \"CC\": \"gcc\",\n        \"CFLAGS\": \"-O2 -Wall\"\n    }\n)\n</code></pre> <p>Equivalent to:</p> <pre><code>CC=gcc CFLAGS='-O2 -Wall' gcc -o app main.c\n</code></pre>"},{"location":"resources/exec/#combined","title":"Combined","text":"<pre><code>Exec(\n    \"deploy\",\n    command=\"./deploy.sh\",\n    cwd=\"/opt/apps/myapp\",\n    environment={\n        \"ENVIRONMENT\": \"production\",\n        \"LOG_LEVEL\": \"info\"\n    }\n)\n</code></pre>"},{"location":"resources/exec/#platform-compatibility","title":"Platform Compatibility","text":"<p>Exec resources work on all platforms that support shell commands:</p> <ul> <li>Linux: Uses <code>/bin/sh</code> or <code>/bin/bash</code></li> <li>macOS: Uses <code>/bin/sh</code> or <code>/bin/bash</code></li> <li>Other Unix-like systems: Uses default shell</li> </ul> <p>Platform-specific commands:</p> <pre><code># Linux-specific\nExec(\"update\", command=\"apt-get update\")\n\n# macOS-specific\nExec(\"update\", command=\"brew update\")\n</code></pre>"},{"location":"resources/exec/#troubleshooting","title":"Troubleshooting","text":""},{"location":"resources/exec/#command-not-found","title":"Command Not Found","text":"<p>Ensure command is in PATH or use full path:</p> <pre><code># May fail if not in PATH\nExec(\"backup\", command=\"mybackup.sh\")\n\n# Better: Use full path\nExec(\"backup\", command=\"/usr/local/bin/mybackup.sh\")\n</code></pre>"},{"location":"resources/exec/#guard-command-fails","title":"Guard Command Fails","text":"<p>Check guard command independently:</p> <pre><code># Test unless guard\nwhich docker  # Should return 0 if installed\n\n# Test only_if guard\nsystemctl is-active postgresql  # Should return 0 if active\n</code></pre>"},{"location":"resources/exec/#security-validation-errors","title":"Security Validation Errors","text":"<p>Review command for dangerous patterns:</p> <pre><code># Error: Command chaining\nExec(\"multi\", command=\"cmd1 &amp;&amp; cmd2\")  # BLOCKED\n\n# Fix: Use separate Exec resources\nExec(\"cmd1\", command=\"cmd1\")\nExec(\"cmd2\", command=\"cmd2\")\n</code></pre>"},{"location":"resources/exec/#environment-variables-not-working","title":"Environment Variables Not Working","text":"<p>Verify environment variable syntax:</p> <pre><code># Correct\nExec(\n    \"deploy\",\n    command=\"./deploy.sh\",\n    environment={\"API_KEY\": \"secret\"}\n)\n\n# Incorrect (command string)\nExec(\"deploy\", command=\"API_KEY=secret ./deploy.sh\")\n</code></pre>"},{"location":"resources/exec/#limitations","title":"Limitations","text":""},{"location":"resources/exec/#no-streaming-output","title":"No Streaming Output","text":"<p>Command output is returned after execution completes. Long-running commands may appear to hang.</p>"},{"location":"resources/exec/#shell-dependency","title":"Shell Dependency","text":"<p>Exec requires a shell to execute commands. Some minimal containers may not have a shell.</p>"},{"location":"resources/exec/#no-interactive-commands","title":"No Interactive Commands","text":"<p>Commands requiring user input will hang. Use non-interactive flags:</p> <pre><code># Good: Non-interactive\nExec(\"install\", command=\"apt-get install -y nginx\")\n\n# Bad: Would hang waiting for input\nExec(\"install\", command=\"apt-get install nginx\")\n</code></pre>"},{"location":"resources/exec/#api-reference","title":"API Reference","text":"<p>See cook/resources/exec.py for complete source code and implementation details.</p>"},{"location":"resources/file/","title":"File Resource","text":"<p>Manage files, directories, templates, and permissions.</p>"},{"location":"resources/file/#overview","title":"Overview","text":"<p>The File resource handles file system operations:</p> <ul> <li>Create and manage files with inline content or from source</li> <li>Create and manage directories</li> <li>Set file permissions (mode, owner, group)</li> <li>Render Jinja2 templates</li> <li>Delete files and directories</li> </ul>"},{"location":"resources/file/#basic-usage","title":"Basic Usage","text":""},{"location":"resources/file/#file-with-inline-content","title":"File with Inline Content","text":"<pre><code>from cook import File\n\nFile(\"/etc/motd\", content=\"Welcome to the server\")\n</code></pre>"},{"location":"resources/file/#file-from-source","title":"File from Source","text":"<pre><code>File(\"/etc/nginx/nginx.conf\", source=\"./configs/nginx.conf\")\n</code></pre>"},{"location":"resources/file/#directory","title":"Directory","text":"<pre><code>File(\"/var/www/app\", ensure=\"directory\", mode=0o755)\n</code></pre>"},{"location":"resources/file/#file-with-permissions","title":"File with Permissions","text":"<pre><code>File(\n    \"/var/www/index.html\",\n    content=\"&lt;h1&gt;Hello World&lt;/h1&gt;\",\n    owner=\"www-data\",\n    group=\"www-data\",\n    mode=0o644\n)\n</code></pre>"},{"location":"resources/file/#parameters","title":"Parameters","text":""},{"location":"resources/file/#path","title":"path","text":"<p>Required. File or directory path on the target system.</p> <pre><code>File(\"/etc/hostname\", content=\"webserver01\")\n</code></pre>"},{"location":"resources/file/#content","title":"content","text":"<p>Inline file content as a string.</p> <p>Mutually exclusive with <code>source</code> and <code>template</code>.</p> <pre><code>File(\"/etc/issue\", content=\"Authorized access only\")\n</code></pre>"},{"location":"resources/file/#source","title":"source","text":"<p>Path to source file on the local system. Content is read and transferred to the target.</p> <p>Mutually exclusive with <code>content</code> and <code>template</code>.</p> <pre><code>File(\"/etc/ssh/sshd_config\", source=\"./configs/sshd_config\")\n</code></pre>"},{"location":"resources/file/#template","title":"template","text":"<p>Path to Jinja2 template file on the local system. Template is rendered with <code>vars</code> and transferred to the target.</p> <p>Mutually exclusive with <code>content</code> and <code>source</code>.</p> <pre><code>File(\n    \"/etc/nginx/sites-available/mysite\",\n    template=\"./templates/nginx-site.j2\",\n    vars={\"domain\": \"example.com\", \"port\": 80}\n)\n</code></pre>"},{"location":"resources/file/#vars","title":"vars","text":"<p>Dictionary of variables for template rendering. Only used with <code>template</code> parameter.</p> <pre><code>File(\n    \"/etc/app/config.yml\",\n    template=\"./templates/config.yml.j2\",\n    vars={\n        \"database_host\": \"localhost\",\n        \"database_port\": 5432,\n        \"debug\": False\n    }\n)\n</code></pre>"},{"location":"resources/file/#ensure","title":"ensure","text":"<p>Resource state: <code>\"file\"</code>, <code>\"directory\"</code>, or <code>\"absent\"</code>.</p> <p>Default: <code>\"file\"</code></p> <pre><code># Ensure file exists\nFile(\"/var/log/app.log\", ensure=\"file\")\n\n# Ensure directory exists\nFile(\"/var/lib/app\", ensure=\"directory\")\n\n# Ensure file is removed\nFile(\"/tmp/old-config\", ensure=\"absent\")\n</code></pre>"},{"location":"resources/file/#mode","title":"mode","text":"<p>File permissions as octal integer.</p> <pre><code># Read/write for owner, read-only for group and others\nFile(\"/etc/app.conf\", content=\"config\", mode=0o644)\n\n# Executable script\nFile(\"/usr/local/bin/backup.sh\", source=\"./backup.sh\", mode=0o755)\n\n# Directory with restricted access\nFile(\"/var/secrets\", ensure=\"directory\", mode=0o700)\n</code></pre>"},{"location":"resources/file/#owner","title":"owner","text":"<p>Owner username for the file or directory.</p> <pre><code>File(\"/var/www/index.html\", content=\"&lt;h1&gt;Hello&lt;/h1&gt;\", owner=\"www-data\")\n</code></pre>"},{"location":"resources/file/#group","title":"group","text":"<p>Group name for the file or directory.</p> <pre><code>File(\"/var/www/index.html\", content=\"&lt;h1&gt;Hello&lt;/h1&gt;\", group=\"www-data\")\n</code></pre>"},{"location":"resources/file/#templates","title":"Templates","text":"<p>File resources support Jinja2 templates for dynamic content generation.</p>"},{"location":"resources/file/#basic-template","title":"Basic Template","text":"<p>Template file: <code>nginx-site.j2</code></p> <pre><code>server {\n    listen 80;\n    server_name {{ domain }};\n\n    location / {\n        proxy_pass http://127.0.0.1:{{ port }};\n    }\n}\n</code></pre> <p>Cook configuration:</p> <pre><code>File(\n    \"/etc/nginx/sites-available/mysite\",\n    template=\"./nginx-site.j2\",\n    vars={\"domain\": \"example.com\", \"port\": 3000}\n)\n</code></pre> <p>Result:</p> <pre><code>server {\n    listen 80;\n    server_name example.com;\n\n    location / {\n        proxy_pass http://127.0.0.1:3000;\n    }\n}\n</code></pre>"},{"location":"resources/file/#conditional-content","title":"Conditional Content","text":"<p>Template file: <code>app-config.j2</code></p> <pre><code>database:\n  host: {{ db_host }}\n  port: {{ db_port }}\n\n{% if enable_cache %}\ncache:\n  enabled: true\n  ttl: {{ cache_ttl }}\n{% endif %}\n\ndebug: {{ debug }}\n</code></pre> <p>Cook configuration:</p> <pre><code>File(\n    \"/etc/app/config.yml\",\n    template=\"./app-config.j2\",\n    vars={\n        \"db_host\": \"localhost\",\n        \"db_port\": 5432,\n        \"enable_cache\": True,\n        \"cache_ttl\": 300,\n        \"debug\": False\n    }\n)\n</code></pre>"},{"location":"resources/file/#lists-in-templates","title":"Lists in Templates","text":"<p>Template file: <code>hosts.j2</code></p> <pre><code>127.0.0.1 localhost\n{% for host in additional_hosts %}\n{{ host.ip }} {{ host.name }}\n{% endfor %}\n</code></pre> <p>Cook configuration:</p> <pre><code>File(\n    \"/etc/hosts\",\n    template=\"./hosts.j2\",\n    vars={\n        \"additional_hosts\": [\n            {\"ip\": \"10.0.0.1\", \"name\": \"db01\"},\n            {\"ip\": \"10.0.0.2\", \"name\": \"cache01\"},\n        ]\n    }\n)\n</code></pre>"},{"location":"resources/file/#examples","title":"Examples","text":""},{"location":"resources/file/#web-application-structure","title":"Web Application Structure","text":"<pre><code>from cook import File\n\n# Application directory\nFile(\"/opt/apps/myapp\", ensure=\"directory\", mode=0o755)\n\n# Data directory with restricted permissions\nFile(\"/opt/apps/myapp/data\", ensure=\"directory\", mode=0o750, owner=\"www-data\")\n\n# Configuration from template\nFile(\n    \"/opt/apps/myapp/config.json\",\n    template=\"./templates/app-config.j2\",\n    vars={\n        \"port\": 3000,\n        \"database\": \"/opt/apps/myapp/data/app.db\"\n    },\n    owner=\"www-data\",\n    mode=0o640\n)\n\n# Static content\nFile(\n    \"/opt/apps/myapp/public/index.html\",\n    source=\"./public/index.html\",\n    owner=\"www-data\",\n    mode=0o644\n)\n</code></pre>"},{"location":"resources/file/#ssh-configuration","title":"SSH Configuration","text":"<pre><code>File(\n    \"/etc/ssh/sshd_config\",\n    source=\"./configs/sshd_config\",\n    mode=0o600,\n    owner=\"root\",\n    group=\"root\"\n)\n</code></pre>"},{"location":"resources/file/#systemd-service","title":"Systemd Service","text":"<pre><code>File(\n    \"/etc/systemd/system/myapp.service\",\n    template=\"./templates/myapp.service.j2\",\n    vars={\n        \"user\": \"www-data\",\n        \"working_directory\": \"/opt/apps/myapp\",\n        \"exec_start\": \"/opt/apps/myapp/start.sh\"\n    },\n    mode=0o644\n)\n</code></pre>"},{"location":"resources/file/#nginx-configuration","title":"Nginx Configuration","text":"<pre><code>File(\n    \"/etc/nginx/sites-available/myapp\",\n    template=\"./templates/nginx.conf.j2\",\n    vars={\n        \"domain\": \"myapp.com\",\n        \"port\": 3000,\n        \"ssl_cert\": \"/etc/letsencrypt/live/myapp.com/fullchain.pem\",\n        \"ssl_key\": \"/etc/letsencrypt/live/myapp.com/privkey.pem\"\n    }\n)\n</code></pre>"},{"location":"resources/file/#remove-old-files","title":"Remove Old Files","text":"<pre><code># Remove temporary files\nFile(\"/tmp/old-cache\", ensure=\"absent\")\nFile(\"/tmp/old-logs\", ensure=\"absent\")\n</code></pre>"},{"location":"resources/file/#file-modes","title":"File Modes","text":"<p>Common permission patterns:</p> Mode Octal Usage rw-r--r-- 0o644 Regular files (config, data) rwxr-xr-x 0o755 Executables, directories rw------- 0o600 Sensitive files (keys, passwords) rwx------ 0o700 Sensitive directories rw-rw-r-- 0o664 Shared files rwxrwxr-x 0o775 Shared directories <p>Examples:</p> <pre><code># Configuration file readable by all\nFile(\"/etc/app.conf\", content=\"config\", mode=0o644)\n\n# Private SSH key\nFile(\"/home/user/.ssh/id_rsa\", source=\"./id_rsa\", mode=0o600)\n\n# Executable script\nFile(\"/usr/local/bin/deploy.sh\", source=\"./deploy.sh\", mode=0o755)\n\n# Web root directory\nFile(\"/var/www/html\", ensure=\"directory\", mode=0o755)\n</code></pre>"},{"location":"resources/file/#idempotency","title":"Idempotency","text":"<p>File resources are idempotent. Repeated application produces the same result.</p>"},{"location":"resources/file/#content-changes","title":"Content Changes","text":"<p>Files are updated only when content differs:</p> <pre><code>File(\"/etc/motd\", content=\"Welcome v1\")\n# First run: Creates file\n# Second run: No changes\n</code></pre> <pre><code>File(\"/etc/motd\", content=\"Welcome v2\")\n# Detects content change, updates file\n</code></pre>"},{"location":"resources/file/#permission-changes","title":"Permission Changes","text":"<p>Permissions are updated only when they differ:</p> <pre><code>File(\"/var/www/index.html\", content=\"&lt;h1&gt;Hello&lt;/h1&gt;\", mode=0o644)\n# First run: Creates with mode 0o644\n# Second run: No changes\n\nFile(\"/var/www/index.html\", content=\"&lt;h1&gt;Hello&lt;/h1&gt;\", mode=0o444)\n# Detects mode change, updates permissions\n</code></pre>"},{"location":"resources/file/#platform-compatibility","title":"Platform Compatibility","text":"<p>File resources work across platforms with automatic command adaptation:</p> <ul> <li>Linux: Uses GNU coreutils (stat, chmod, chown)</li> <li>macOS: Uses BSD versions of commands</li> <li>stat format: Automatically detects GNU vs BSD stat</li> </ul> <p>The resource handles platform differences transparently.</p>"},{"location":"resources/file/#security-considerations","title":"Security Considerations","text":""},{"location":"resources/file/#sensitive-files","title":"Sensitive Files","text":"<p>Protect sensitive files with restrictive permissions:</p> <pre><code># SSH private key\nFile(\n    \"/home/deploy/.ssh/id_rsa\",\n    source=\"./keys/deploy_rsa\",\n    mode=0o600,\n    owner=\"deploy\",\n    group=\"deploy\"\n)\n\n# Database credentials\nFile(\n    \"/etc/app/db_password\",\n    content=os.getenv(\"DB_PASSWORD\"),\n    mode=0o600,\n    owner=\"app\",\n    group=\"app\"\n)\n</code></pre>"},{"location":"resources/file/#directory-permissions","title":"Directory Permissions","text":"<p>Restrict directory access when containing sensitive data:</p> <pre><code># Application secrets directory\nFile(\n    \"/var/secrets\",\n    ensure=\"directory\",\n    mode=0o700,\n    owner=\"app\"\n)\n\n# SSL certificate directory\nFile(\n    \"/etc/ssl/private\",\n    ensure=\"directory\",\n    mode=0o710,\n    owner=\"root\",\n    group=\"ssl-cert\"\n)\n</code></pre>"},{"location":"resources/file/#template-variables","title":"Template Variables","text":"<p>Avoid embedding secrets directly in templates. Use environment variables:</p> <pre><code>import os\n\nFile(\n    \"/etc/app/config.yml\",\n    template=\"./config.yml.j2\",\n    vars={\n        \"api_key\": os.getenv(\"API_KEY\"),\n        \"db_password\": os.getenv(\"DB_PASSWORD\")\n    },\n    mode=0o600\n)\n</code></pre>"},{"location":"resources/file/#common-patterns","title":"Common Patterns","text":""},{"location":"resources/file/#multi-file-application-setup","title":"Multi-File Application Setup","text":"<pre><code>from cook import File\n\nAPP_DIR = \"/opt/apps/myapp\"\n\n# Directory structure\nFile(APP_DIR, ensure=\"directory\", mode=0o755)\nFile(f\"{APP_DIR}/config\", ensure=\"directory\", mode=0o755)\nFile(f\"{APP_DIR}/data\", ensure=\"directory\", mode=0o750, owner=\"app\")\nFile(f\"{APP_DIR}/logs\", ensure=\"directory\", mode=0o755, owner=\"app\")\n\n# Configuration files\nFile(f\"{APP_DIR}/config/app.yml\", template=\"./app.yml.j2\", vars={...})\nFile(f\"{APP_DIR}/config/database.yml\", template=\"./db.yml.j2\", vars={...})\n\n# Application files\nFile(f\"{APP_DIR}/start.sh\", source=\"./start.sh\", mode=0o755)\n</code></pre>"},{"location":"resources/file/#configuration-management","title":"Configuration Management","text":"<pre><code># Environment-specific configuration\nenv = os.getenv(\"ENV\", \"production\")\n\nFile(\n    \"/etc/app/config.yml\",\n    template=\"./config.yml.j2\",\n    vars={\n        \"environment\": env,\n        \"debug\": env == \"development\",\n        \"log_level\": \"debug\" if env == \"development\" else \"info\"\n    }\n)\n</code></pre>"},{"location":"resources/file/#api-reference","title":"API Reference","text":"<p>See cook/resources/file.py for complete source code and implementation details.</p>"},{"location":"resources/package/","title":"Package Resource","text":"<p>Install and manage system packages across multiple platforms.</p>"},{"location":"resources/package/#overview","title":"Overview","text":"<p>The Package resource handles package installation and removal:</p> <ul> <li>Install packages on apt, dnf, pacman, and brew</li> <li>Remove packages</li> <li>Check package installation status</li> <li>Support for single and multiple packages</li> <li>Automatic platform detection</li> <li>Non-interactive installation (no confirmation prompts)</li> </ul>"},{"location":"resources/package/#supported-package-managers","title":"Supported Package Managers","text":"Platform Package Manager Install Remove Check Ubuntu/Debian apt Yes Yes Yes Fedora/RHEL dnf Yes Yes Yes Arch Linux pacman Yes Yes Yes macOS brew Yes Yes Yes"},{"location":"resources/package/#basic-usage","title":"Basic Usage","text":""},{"location":"resources/package/#single-package","title":"Single Package","text":"<pre><code>from cook import Package\n\nPackage(\"nginx\")\n</code></pre>"},{"location":"resources/package/#multiple-packages-list","title":"Multiple Packages (List)","text":"<pre><code>Package([\"gcc\", \"make\", \"autoconf\"])\n</code></pre>"},{"location":"resources/package/#multiple-packages-named-group","title":"Multiple Packages (Named Group)","text":"<pre><code>Package(\"build-tools\", packages=[\"gcc\", \"make\", \"autoconf\"])\n</code></pre>"},{"location":"resources/package/#remove-package","title":"Remove Package","text":"<pre><code>Package(\"apache2\", ensure=\"absent\")\n</code></pre>"},{"location":"resources/package/#parameters","title":"Parameters","text":""},{"location":"resources/package/#name","title":"name","text":"<p>Required. Package name or list of packages.</p> <p>Can be: - String: Single package name - List: Multiple package names (convenience syntax)</p> <pre><code># Single package\nPackage(\"nginx\")\n\n# Multiple packages\nPackage([\"nginx\", \"curl\", \"git\"])\n</code></pre>"},{"location":"resources/package/#packages","title":"packages","text":"<p>List of package names to install as a group.</p> <pre><code>Package(\"web-server\", packages=[\"nginx\", \"certbot\", \"python3-certbot-nginx\"])\n</code></pre>"},{"location":"resources/package/#ensure","title":"ensure","text":"<p>Package state: <code>\"present\"</code>, <code>\"absent\"</code>, or <code>\"latest\"</code>.</p> <p>Default: <code>\"present\"</code></p> <pre><code># Install package\nPackage(\"nginx\", ensure=\"present\")\n\n# Remove package\nPackage(\"apache2\", ensure=\"absent\")\n\n# Upgrade to latest\nPackage(\"nginx\", ensure=\"latest\")\n</code></pre>"},{"location":"resources/package/#version","title":"version","text":"<p>Specific package version to install (support varies by package manager).</p> <pre><code>Package(\"nginx\", version=\"1.18.0-1ubuntu1\")\n</code></pre> <p>Note: Version support depends on the package manager. Some package managers may not support pinning to specific versions.</p>"},{"location":"resources/package/#examples","title":"Examples","text":""},{"location":"resources/package/#web-server-stack","title":"Web Server Stack","text":"<pre><code>from cook import Package\n\n# Individual packages\nPackage(\"nginx\")\nPackage(\"certbot\")\n\n# Or as a group\nPackage(\"web-stack\", packages=[\n    \"nginx\",\n    \"certbot\",\n    \"python3-certbot-nginx\"\n])\n</code></pre>"},{"location":"resources/package/#development-tools","title":"Development Tools","text":"<pre><code>Package(\"build-tools\", packages=[\n    \"gcc\",\n    \"g++\",\n    \"make\",\n    \"autoconf\",\n    \"automake\",\n    \"cmake\"\n])\n</code></pre>"},{"location":"resources/package/#database-server","title":"Database Server","text":"<pre><code>Package(\"postgresql\", packages=[\n    \"postgresql\",\n    \"postgresql-contrib\",\n    \"libpq-dev\"\n])\n</code></pre>"},{"location":"resources/package/#nodejs-application-dependencies","title":"Node.js Application Dependencies","text":"<pre><code># After adding NodeSource repository\nPackage(\"nodejs\")\n\n# Additional tools\nPackage(\"node-tools\", packages=[\n    \"npm\",\n    \"yarn\"\n])\n</code></pre>"},{"location":"resources/package/#docker-installation","title":"Docker Installation","text":"<pre><code># After adding Docker repository\nPackage(\"docker\", packages=[\n    \"docker-ce\",\n    \"docker-ce-cli\",\n    \"containerd.io\",\n    \"docker-compose-plugin\"\n])\n</code></pre>"},{"location":"resources/package/#remove-unwanted-packages","title":"Remove Unwanted Packages","text":"<pre><code>Package(\"apache2\", ensure=\"absent\")\nPackage(\"sendmail\", ensure=\"absent\")\n</code></pre>"},{"location":"resources/package/#non-interactive-installation","title":"Non-Interactive Installation","text":"<p>All package installations run non-interactively to prevent blocking on user input.</p>"},{"location":"resources/package/#apt-debianubuntu","title":"APT (Debian/Ubuntu)","text":"<pre><code>DEBIAN_FRONTEND=noninteractive apt-get install -y &lt;packages&gt;\n</code></pre> <p>Prevents configuration prompts and package installation questions.</p>"},{"location":"resources/package/#dnf-fedorarhel","title":"DNF (Fedora/RHEL)","text":"<pre><code>dnf install -y &lt;packages&gt;\n</code></pre> <p>The <code>-y</code> flag automatically confirms all prompts.</p>"},{"location":"resources/package/#pacman-arch","title":"Pacman (Arch)","text":"<pre><code>pacman -S --noconfirm &lt;packages&gt;\n</code></pre> <p>The <code>--noconfirm</code> flag bypasses all confirmation prompts.</p>"},{"location":"resources/package/#brew-macos","title":"Brew (macOS)","text":"<pre><code>brew install &lt;packages&gt;\n</code></pre> <p>Homebrew does not prompt for confirmation by default.</p>"},{"location":"resources/package/#package-groups","title":"Package Groups","text":"<p>Group related packages for better organization:</p> <pre><code>from cook import Package\n\n# Web server stack\nPackage(\"web-server\", packages=[\n    \"nginx\",\n    \"certbot\",\n    \"python3-certbot-nginx\"\n])\n\n# Application runtime\nPackage(\"app-runtime\", packages=[\n    \"python3\",\n    \"python3-pip\",\n    \"python3-venv\"\n])\n\n# Monitoring tools\nPackage(\"monitoring\", packages=[\n    \"prometheus-node-exporter\",\n    \"netdata\"\n])\n</code></pre>"},{"location":"resources/package/#idempotency","title":"Idempotency","text":"<p>Package resources are idempotent. Repeated installation of the same package does not reinstall.</p> <pre><code>Package(\"nginx\")\n# First run: Installs nginx\n# Second run: Detects nginx already installed, no changes\n</code></pre> <p>Package removal:</p> <pre><code>Package(\"apache2\", ensure=\"absent\")\n# First run: Removes apache2\n# Second run: Detects apache2 not installed, no changes\n</code></pre>"},{"location":"resources/package/#platform-specific-behavior","title":"Platform-Specific Behavior","text":""},{"location":"resources/package/#apt-debianubuntu_1","title":"APT (Debian/Ubuntu)","text":"<pre><code>Package(\"nginx\")\n</code></pre> <p>Equivalent to:</p> <pre><code>apt-get install -y nginx\n</code></pre> <p>Package check uses <code>dpkg-query</code>:</p> <pre><code>dpkg-query -W -f='${Version}' nginx\n</code></pre>"},{"location":"resources/package/#dnf-fedorarhel_1","title":"DNF (Fedora/RHEL)","text":"<pre><code>Package(\"nginx\")\n</code></pre> <p>Equivalent to:</p> <pre><code>dnf install -y nginx\n</code></pre> <p>Package check uses <code>rpm</code>:</p> <pre><code>rpm -q --queryformat '%{VERSION}' nginx\n</code></pre>"},{"location":"resources/package/#pacman-arch_1","title":"Pacman (Arch)","text":"<pre><code>Package(\"nginx\")\n</code></pre> <p>Equivalent to:</p> <pre><code>pacman -S --noconfirm nginx\n</code></pre> <p>Package check:</p> <pre><code>pacman -Q nginx\n</code></pre>"},{"location":"resources/package/#homebrew-macos","title":"Homebrew (macOS)","text":"<pre><code>Package(\"nginx\")\n</code></pre> <p>Equivalent to:</p> <pre><code>brew install nginx\n</code></pre> <p>Package check:</p> <pre><code>brew list --versions nginx\n</code></pre>"},{"location":"resources/package/#complete-workflow","title":"Complete Workflow","text":"<p>Typical pattern for system setup:</p> <pre><code>from cook import Repository, Package\n\n# Update package cache\nRepository(\"apt-update\", action=\"update\")\n\n# Upgrade existing packages\nRepository(\"apt-upgrade\", action=\"upgrade\")\n\n# Install system tools\nPackage(\"system-tools\", packages=[\n    \"curl\",\n    \"wget\",\n    \"git\",\n    \"vim\",\n    \"htop\"\n])\n\n# Install web server\nPackage(\"nginx\")\n\n# Install application runtime\nPackage(\"python-runtime\", packages=[\n    \"python3\",\n    \"python3-pip\",\n    \"python3-venv\"\n])\n</code></pre>"},{"location":"resources/package/#working-with-repositories","title":"Working with Repositories","text":"<p>Add custom repositories before installing packages from them:</p> <pre><code>from cook import Repository, Package\n\n# Add NodeSource repository\nRepository(\n    \"nodesource\",\n    action=\"add\",\n    repo=\"deb https://deb.nodesource.com/node_20.x nodistro main\",\n    key_url=\"https://deb.nodesource.com/gpgkey/nodesource.gpg.key\"\n)\n\n# Update cache after adding repository\nRepository(\"apt-update\", action=\"update\")\n\n# Install from new repository\nPackage(\"nodejs\")\n</code></pre>"},{"location":"resources/package/#version-management","title":"Version Management","text":"<p>Request specific versions when needed:</p> <pre><code># Specific version\nPackage(\"nginx\", version=\"1.18.0-1ubuntu1\")\n\n# Latest version\nPackage(\"nginx\", ensure=\"latest\")\n</code></pre> <p>Note: Version support varies by package manager. Test on your target platform.</p>"},{"location":"resources/package/#security-considerations","title":"Security Considerations","text":""},{"location":"resources/package/#package-sources","title":"Package Sources","text":"<p>Only install packages from trusted repositories:</p> <pre><code># Good: Official repository\nPackage(\"nginx\")\n\n# Good: Well-known third-party with GPG verification\nRepository(\n    \"docker\",\n    action=\"add\",\n    repo=\"deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable\",\n    key_url=\"https://download.docker.com/linux/ubuntu/gpg\"\n)\nPackage(\"docker-ce\")\n</code></pre>"},{"location":"resources/package/#system-updates","title":"System Updates","text":"<p>Keep systems updated:</p> <pre><code>from cook import Repository, Package\n\n# Regular updates\nRepository(\"system-update\", action=\"update\")\nRepository(\"system-upgrade\", action=\"upgrade\")\n</code></pre>"},{"location":"resources/package/#minimal-installation","title":"Minimal Installation","text":"<p>Install only necessary packages:</p> <pre><code># Install minimal set\nPackage(\"production-tools\", packages=[\n    \"nginx\",\n    \"python3\",\n    \"certbot\"\n])\n\n# Avoid installing development tools on production unless needed\n</code></pre>"},{"location":"resources/package/#common-patterns","title":"Common Patterns","text":""},{"location":"resources/package/#full-lemp-stack","title":"Full LEMP Stack","text":"<pre><code>from cook import Repository, Package\n\n# Update system\nRepository(\"apt-update\", action=\"update\")\n\n# Install LEMP stack\nPackage(\"lemp\", packages=[\n    \"nginx\",\n    \"mysql-server\",\n    \"php-fpm\",\n    \"php-mysql\"\n])\n</code></pre>"},{"location":"resources/package/#python-development-environment","title":"Python Development Environment","text":"<pre><code>Package(\"python-dev\", packages=[\n    \"python3\",\n    \"python3-pip\",\n    \"python3-venv\",\n    \"python3-dev\",\n    \"build-essential\"\n])\n</code></pre>"},{"location":"resources/package/#container-platform","title":"Container Platform","text":"<pre><code># Add Docker repository first\nRepository(\n    \"docker\",\n    action=\"add\",\n    repo=\"deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable\",\n    key_url=\"https://download.docker.com/linux/ubuntu/gpg\"\n)\n\nRepository(\"apt-update\", action=\"update\")\n\n# Install Docker\nPackage(\"docker\", packages=[\n    \"docker-ce\",\n    \"docker-ce-cli\",\n    \"containerd.io\",\n    \"docker-compose-plugin\"\n])\n</code></pre>"},{"location":"resources/package/#ssltls-certificates","title":"SSL/TLS Certificates","text":"<pre><code>Package(\"certbot\", packages=[\n    \"certbot\",\n    \"python3-certbot-nginx\"\n])\n</code></pre>"},{"location":"resources/package/#troubleshooting","title":"Troubleshooting","text":""},{"location":"resources/package/#package-not-found","title":"Package Not Found","text":"<p>Ensure repository is added and cache is updated:</p> <pre><code># Add repository\nRepository(\"custom-repo\", action=\"add\", repo=\"...\")\n\n# Update cache\nRepository(\"apt-update\", action=\"update\")\n\n# Then install\nPackage(\"custom-package\")\n</code></pre>"},{"location":"resources/package/#installation-fails","title":"Installation Fails","text":"<p>Check platform compatibility and package name:</p> <pre><code># Ubuntu/Debian\nPackage(\"nodejs\")\n\n# Some platforms may use different names\n# Verify with: apt-cache search nodejs\n</code></pre>"},{"location":"resources/package/#version-conflicts","title":"Version Conflicts","text":"<p>Use version pinning when specific versions are required:</p> <pre><code>Package(\"nginx\", version=\"1.18.0-1ubuntu1\")\n</code></pre>"},{"location":"resources/package/#api-reference","title":"API Reference","text":"<p>See cook/resources/pkg.py for complete source code and implementation details.</p>"},{"location":"resources/repository/","title":"Repository Resource","text":"<p>Manage package repositories, system updates, and package manager operations.</p>"},{"location":"resources/repository/#overview","title":"Overview","text":"<p>The Repository resource handles package manager lifecycle operations:</p> <ul> <li>Update package cache</li> <li>Upgrade installed packages</li> <li>Add and remove repositories</li> <li>Manage GPG keys</li> <li>Configure repository files</li> </ul>"},{"location":"resources/repository/#supported-package-managers","title":"Supported Package Managers","text":"Platform Package Manager Update Upgrade Add Repo Ubuntu/Debian apt Yes Yes Yes Fedora/RHEL dnf Yes Yes Yes Arch Linux pacman Yes Yes Yes macOS brew Yes Yes Yes"},{"location":"resources/repository/#basic-usage","title":"Basic Usage","text":""},{"location":"resources/repository/#update-package-cache","title":"Update Package Cache","text":"<pre><code>from cook import Repository\n\nRepository(\"apt-update\", action=\"update\")\n</code></pre> <p>Equivalent to:</p> <pre><code>apt-get update\n</code></pre>"},{"location":"resources/repository/#upgrade-all-packages","title":"Upgrade All Packages","text":"<pre><code>Repository(\"apt-upgrade\", action=\"upgrade\")\n</code></pre> <p>Equivalent to:</p> <pre><code>apt-get upgrade -y\n</code></pre>"},{"location":"resources/repository/#add-repository","title":"Add Repository","text":"<pre><code>Repository(\n    \"docker\",\n    action=\"add\",\n    repo=\"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\",\n    key_url=\"https://download.docker.com/linux/ubuntu/gpg\",\n    filename=\"docker.list\"\n)\n</code></pre>"},{"location":"resources/repository/#actions","title":"Actions","text":""},{"location":"resources/repository/#update","title":"update","text":"<p>Updates the package manager cache.</p> <p>Parameters:</p> <ul> <li><code>name</code>: Identifier for the resource</li> </ul> <p>Example:</p> <pre><code>Repository(\"system-update\", action=\"update\")\n</code></pre> <p>Behavior:</p> <ul> <li>APT: Runs <code>apt-get update</code></li> <li>DNF: Runs <code>dnf check-update</code></li> <li>Pacman: Runs <code>pacman -Sy</code></li> <li>Brew: Runs <code>brew update</code></li> </ul> <p>Idempotency:</p> <p>Checks cache age. If cache is fresh (less than 1 hour old), no action is taken.</p>"},{"location":"resources/repository/#upgrade","title":"upgrade","text":"<p>Upgrades all installed packages.</p> <p>Parameters:</p> <ul> <li><code>name</code>: Identifier for the resource</li> </ul> <p>Example:</p> <pre><code>Repository(\"system-upgrade\", action=\"upgrade\")\n</code></pre> <p>Behavior:</p> <ul> <li>APT: Runs <code>apt-get upgrade -y</code></li> <li>DNF: Runs <code>dnf upgrade -y</code></li> <li>Pacman: Runs <code>pacman -Su --noconfirm</code></li> <li>Brew: Runs <code>brew upgrade</code></li> </ul> <p>Idempotency:</p> <p>Checks for upgradable packages. If none are available, no action is taken.</p>"},{"location":"resources/repository/#add","title":"add","text":"<p>Adds a new package repository.</p> <p>Parameters:</p> <ul> <li><code>name</code>: Repository identifier</li> <li><code>repo</code>: Repository line (format varies by package manager)</li> <li><code>key_url</code>: URL to GPG public key (optional)</li> <li><code>key_id</code>: GPG key ID (optional)</li> <li><code>key_server</code>: GPG keyserver (default: keyserver.ubuntu.com)</li> <li><code>ppa</code>: Ubuntu PPA name (Ubuntu only)</li> <li><code>tap</code>: Homebrew tap name (macOS only)</li> <li><code>filename</code>: Custom filename for repository file</li> <li><code>ensure</code>: \"present\" or \"absent\"</li> </ul>"},{"location":"resources/repository/#examples","title":"Examples","text":""},{"location":"resources/repository/#nodesource-repository","title":"NodeSource Repository","text":"<p>Add Node.js 20.x repository:</p> <pre><code>Repository(\n    \"nodesource\",\n    action=\"add\",\n    repo=\"deb https://deb.nodesource.com/node_20.x nodistro main\",\n    key_url=\"https://deb.nodesource.com/gpgkey/nodesource.gpg.key\",\n    filename=\"nodesource.list\"\n)\n</code></pre>"},{"location":"resources/repository/#docker-repository","title":"Docker Repository","text":"<pre><code>Repository(\n    \"docker\",\n    action=\"add\",\n    repo=\"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\",\n    key_url=\"https://download.docker.com/linux/ubuntu/gpg\",\n    filename=\"docker.list\"\n)\n</code></pre>"},{"location":"resources/repository/#ubuntu-ppa","title":"Ubuntu PPA","text":"<pre><code>Repository(\n    \"ondrej-php\",\n    action=\"add\",\n    ppa=\"ppa:ondrej/php\"\n)\n</code></pre>"},{"location":"resources/repository/#homebrew-tap","title":"Homebrew Tap","text":"<pre><code>Repository(\n    \"custom-tap\",\n    action=\"add\",\n    tap=\"homebrew/cask-fonts\"\n)\n</code></pre>"},{"location":"resources/repository/#remove-repository","title":"Remove Repository","text":"<pre><code>Repository(\n    \"old-repo\",\n    action=\"add\",\n    repo=\"deb https://old.example.com/ubuntu focal main\",\n    ensure=\"absent\"\n)\n</code></pre>"},{"location":"resources/repository/#complete-workflow","title":"Complete Workflow","text":"<p>Typical pattern for adding a repository and installing packages:</p> <pre><code>from cook import Repository, Package\n\n# Update system\nRepository(\"apt-update\", action=\"update\")\nRepository(\"apt-upgrade\", action=\"upgrade\")\n\n# Add Docker repository\nRepository(\n    \"docker\",\n    action=\"add\",\n    repo=\"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\",\n    key_url=\"https://download.docker.com/linux/ubuntu/gpg\",\n    filename=\"docker.list\"\n)\n\n# Update cache after adding repository\nRepository(\"apt-update-post\", action=\"update\")\n\n# Install packages from new repository\nPackage(\"docker\", packages=[\n    \"docker-ce\",\n    \"docker-ce-cli\",\n    \"containerd.io\",\n])\n</code></pre>"},{"location":"resources/repository/#variable-expansion","title":"Variable Expansion","text":"<p>Repository lines support variable expansion:</p> <pre><code># $(lsb_release -cs) expands to Ubuntu codename\nRepository(\n    \"example\",\n    repo=\"deb https://example.com/ubuntu $(lsb_release -cs) main\"\n)\n</code></pre> <p>On Ubuntu 22.04 (Jammy), this becomes:</p> <pre><code>deb https://example.com/ubuntu jammy main\n</code></pre>"},{"location":"resources/repository/#gpg-key-management","title":"GPG Key Management","text":""},{"location":"resources/repository/#from-url","title":"From URL","text":"<pre><code>Repository(\n    \"repo-name\",\n    action=\"add\",\n    repo=\"deb https://example.com/ubuntu focal main\",\n    key_url=\"https://example.com/key.gpg\"\n)\n</code></pre> <p>Key is downloaded and stored in <code>/etc/apt/trusted.gpg.d/repo-name.gpg</code></p>"},{"location":"resources/repository/#from-keyserver","title":"From Keyserver","text":"<pre><code>Repository(\n    \"repo-name\",\n    action=\"add\",\n    repo=\"deb https://example.com/ubuntu focal main\",\n    key_id=\"9DC858229FC7DD38854AE2D88D81803C0EBFCD88\",\n    key_server=\"keyserver.ubuntu.com\"\n)\n</code></pre>"},{"location":"resources/repository/#files-created","title":"Files Created","text":""},{"location":"resources/repository/#apt-debianubuntu","title":"APT (Debian/Ubuntu)","text":"<ul> <li>Repository file: <code>/etc/apt/sources.list.d/{filename}</code></li> <li>GPG key: <code>/etc/apt/trusted.gpg.d/{name}.gpg</code></li> </ul>"},{"location":"resources/repository/#dnf-fedorarhel","title":"DNF (Fedora/RHEL)","text":"<ul> <li>Repository file: <code>/etc/yum.repos.d/{name}.repo</code></li> </ul>"},{"location":"resources/repository/#pacman-arch","title":"Pacman (Arch)","text":"<ul> <li>Modifies: <code>/etc/pacman.conf</code></li> </ul>"},{"location":"resources/repository/#security-considerations","title":"Security Considerations","text":""},{"location":"resources/repository/#non-interactive-installation","title":"Non-Interactive Installation","text":"<p>All operations use non-interactive flags:</p> <ul> <li>APT: <code>DEBIAN_FRONTEND=noninteractive</code> + <code>-y</code></li> <li>DNF: <code>-y</code></li> <li>Pacman: <code>--noconfirm</code></li> </ul>"},{"location":"resources/repository/#gpg-key-verification","title":"GPG Key Verification","text":"<p>Always specify <code>key_url</code> or <code>key_id</code> when adding repositories from third parties:</p> <pre><code># Good: Includes GPG key\nRepository(\n    \"docker\",\n    repo=\"deb https://download.docker.com/linux/ubuntu focal stable\",\n    key_url=\"https://download.docker.com/linux/ubuntu/gpg\"\n)\n\n# Avoid: No GPG verification\nRepository(\n    \"untrusted\",\n    repo=\"deb [trusted=yes] https://untrusted.example.com/repo focal main\"\n)\n</code></pre>"},{"location":"resources/repository/#platform-specific-notes","title":"Platform-Specific Notes","text":""},{"location":"resources/repository/#apt-cache-age","title":"APT Cache Age","text":"<p>Cache is considered stale if older than 1 hour. Modify by implementing custom check logic.</p>"},{"location":"resources/repository/#dnf-update-vs-check-update","title":"DNF Update vs Check-Update","text":"<p>DNF uses <code>check-update</code> for the update action, which does not modify the system.</p>"},{"location":"resources/repository/#pacman-sync-database","title":"Pacman Sync Database","text":"<p>Pacman's <code>-Sy</code> only synchronizes package databases, does not upgrade packages.</p>"},{"location":"resources/repository/#homebrew-taps","title":"Homebrew Taps","text":"<p>Homebrew taps are Git repositories. Removing a tap does not uninstall packages from that tap.</p>"},{"location":"resources/repository/#api-reference","title":"API Reference","text":"<p>See cook/resources/repository.py for complete source code and docstrings.</p>"},{"location":"resources/service/","title":"Service Resource","text":"<p>Manage system services (systemd, launchctl) and service lifecycle.</p>"},{"location":"resources/service/#overview","title":"Overview","text":"<p>The Service resource handles service management:</p> <ul> <li>Start and stop services</li> <li>Enable and disable services at boot</li> <li>Automatic reload on configuration changes</li> <li>Automatic restart on binary updates</li> <li>Cross-platform support (Linux systemd, macOS launchctl)</li> </ul>"},{"location":"resources/service/#supported-service-managers","title":"Supported Service Managers","text":"Platform Service Manager Start/Stop Enable/Disable Reload Restart Linux systemd Yes Yes Yes Yes macOS launchctl Yes Limited No Yes"},{"location":"resources/service/#basic-usage","title":"Basic Usage","text":""},{"location":"resources/service/#start-service","title":"Start Service","text":"<pre><code>from cook import Service\n\nService(\"nginx\", running=True)\n</code></pre>"},{"location":"resources/service/#enable-service-at-boot","title":"Enable Service at Boot","text":"<pre><code>Service(\"nginx\", running=True, enabled=True)\n</code></pre>"},{"location":"resources/service/#stop-service","title":"Stop Service","text":"<pre><code>Service(\"apache2\", running=False)\n</code></pre>"},{"location":"resources/service/#disable-service","title":"Disable Service","text":"<pre><code>Service(\"apache2\", enabled=False)\n</code></pre>"},{"location":"resources/service/#parameters","title":"Parameters","text":""},{"location":"resources/service/#name","title":"name","text":"<p>Required. Service name as recognized by the service manager.</p> <pre><code>Service(\"nginx\", running=True)\n</code></pre> <p>On systemd, this corresponds to the unit name (e.g., <code>nginx.service</code>).</p>"},{"location":"resources/service/#running","title":"running","text":"<p>Whether the service should be running.</p> <ul> <li><code>True</code>: Service must be running</li> <li><code>False</code>: Service must be stopped</li> <li><code>None</code>: No running state enforcement (default)</li> </ul> <pre><code># Ensure service is running\nService(\"nginx\", running=True)\n\n# Ensure service is stopped\nService(\"apache2\", running=False)\n</code></pre>"},{"location":"resources/service/#enabled","title":"enabled","text":"<p>Whether the service should be enabled at boot.</p> <ul> <li><code>True</code>: Service starts at boot</li> <li><code>False</code>: Service does not start at boot</li> <li><code>None</code>: No boot state enforcement (default)</li> </ul> <pre><code># Enable at boot\nService(\"nginx\", enabled=True)\n\n# Disable at boot\nService(\"apache2\", enabled=False)\n</code></pre>"},{"location":"resources/service/#reload_on","title":"reload_on","text":"<p>List of resources that trigger a service reload when changed.</p> <pre><code>nginx_conf = File(\"/etc/nginx/nginx.conf\", source=\"./nginx.conf\")\n\nService(\"nginx\", running=True, reload_on=[nginx_conf])\n</code></pre> <p>When <code>nginx_conf</code> changes, the service is reloaded (not restarted).</p>"},{"location":"resources/service/#restart_on","title":"restart_on","text":"<p>List of resources that trigger a service restart when changed.</p> <pre><code>app_binary = File(\"/usr/local/bin/app\", source=\"./app\")\n\nService(\"app\", running=True, restart_on=[app_binary])\n</code></pre> <p>When <code>app_binary</code> changes, the service is restarted.</p>"},{"location":"resources/service/#automatic-reload-and-restart","title":"Automatic Reload and Restart","text":"<p>Services can automatically reload or restart when dependencies change.</p>"},{"location":"resources/service/#reload-on-configuration-change","title":"Reload on Configuration Change","text":"<p>Use <code>reload_on</code> for configuration file changes. This reloads the service without dropping connections.</p> <pre><code>from cook import File, Service\n\n# Nginx configuration\nnginx_conf = File(\"/etc/nginx/nginx.conf\", source=\"./nginx.conf\")\n\n# Reload nginx when config changes\nService(\"nginx\", running=True, enabled=True, reload_on=[nginx_conf])\n</code></pre> <p>Workflow: 1. Cook detects <code>nginx.conf</code> changed 2. Cook applies file changes 3. Cook reloads nginx service (graceful reload)</p>"},{"location":"resources/service/#restart-on-binary-update","title":"Restart on Binary Update","text":"<p>Use <code>restart_on</code> for binary or critical file changes. This fully restarts the service.</p> <pre><code>from cook import File, Service\n\n# Application binary\napp_binary = File(\"/opt/apps/myapp/app\", source=\"./app\", mode=0o755)\n\n# Application service file\napp_service = File(\n    \"/etc/systemd/system/myapp.service\",\n    source=\"./myapp.service\"\n)\n\n# Restart when binary or service file changes\nService(\"myapp\", running=True, enabled=True, restart_on=[app_binary, app_service])\n</code></pre> <p>Workflow: 1. Cook detects <code>app</code> binary changed 2. Cook applies file changes 3. Cook restarts myapp service (full restart)</p>"},{"location":"resources/service/#multiple-triggers","title":"Multiple Triggers","text":"<p>Combine reload and restart triggers:</p> <pre><code>from cook import File, Service\n\n# Configuration files\nnginx_conf = File(\"/etc/nginx/nginx.conf\", source=\"./nginx.conf\")\nsite_conf = File(\"/etc/nginx/sites-available/mysite\", source=\"./mysite.conf\")\n\n# Binary files\nnginx_binary = File(\"/usr/sbin/nginx\", source=\"./nginx\", mode=0o755)\n\n# Reload on config changes, restart on binary changes\nService(\n    \"nginx\",\n    running=True,\n    enabled=True,\n    reload_on=[nginx_conf, site_conf],\n    restart_on=[nginx_binary]\n)\n</code></pre>"},{"location":"resources/service/#examples","title":"Examples","text":""},{"location":"resources/service/#web-server","title":"Web Server","text":"<pre><code>from cook import Package, File, Service\n\n# Install nginx\nPackage(\"nginx\")\n\n# Configure nginx\nnginx_conf = File(\"/etc/nginx/nginx.conf\", source=\"./nginx.conf\")\nsite_conf = File(\"/etc/nginx/sites-available/default\", source=\"./default.conf\")\n\n# Manage service\nService(\"nginx\", running=True, enabled=True, reload_on=[nginx_conf, site_conf])\n</code></pre>"},{"location":"resources/service/#application-server","title":"Application Server","text":"<pre><code>from cook import File, Service\n\n# Application files\napp_dir = File(\"/opt/apps/myapp\", ensure=\"directory\", mode=0o755)\napp_binary = File(\"/opt/apps/myapp/app\", source=\"./app\", mode=0o755)\napp_config = File(\"/opt/apps/myapp/config.yml\", source=\"./config.yml\")\n\n# Systemd service file\nservice_file = File(\n    \"/etc/systemd/system/myapp.service\",\n    template=\"./myapp.service.j2\",\n    vars={\"user\": \"app\", \"workdir\": \"/opt/apps/myapp\"}\n)\n\n# Manage service\nService(\n    \"myapp\",\n    running=True,\n    enabled=True,\n    reload_on=[app_config],\n    restart_on=[app_binary, service_file]\n)\n</code></pre>"},{"location":"resources/service/#database-server","title":"Database Server","text":"<pre><code>from cook import Package, Service\n\n# Install PostgreSQL\nPackage(\"postgresql\")\n\n# Ensure service is running and enabled\nService(\"postgresql\", running=True, enabled=True)\n</code></pre>"},{"location":"resources/service/#docker-daemon","title":"Docker Daemon","text":"<pre><code>from cook import Package, File, Service\n\n# Install Docker\nPackage(\"docker\", packages=[\"docker-ce\", \"docker-ce-cli\", \"containerd.io\"])\n\n# Docker daemon configuration\ndaemon_config = File(\n    \"/etc/docker/daemon.json\",\n    source=\"./docker-daemon.json\",\n    mode=0o644\n)\n\n# Manage Docker service\nService(\"docker\", running=True, enabled=True, restart_on=[daemon_config])\n</code></pre>"},{"location":"resources/service/#disable-unwanted-service","title":"Disable Unwanted Service","text":"<pre><code>Service(\"apache2\", running=False, enabled=False)\n</code></pre>"},{"location":"resources/service/#systemd-service-files","title":"Systemd Service Files","text":"<p>Create custom systemd services with File resource:</p>"},{"location":"resources/service/#simple-service","title":"Simple Service","text":"<p>Template: <code>myapp.service.j2</code></p> <pre><code>[Unit]\nDescription=My Application\nAfter=network.target\n\n[Service]\nType=simple\nUser={{ user }}\nWorkingDirectory={{ workdir }}\nExecStart={{ exec_start }}\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Cook configuration:</p> <pre><code>from cook import File, Service\n\n# Create service file\nservice_file = File(\n    \"/etc/systemd/system/myapp.service\",\n    template=\"./myapp.service.j2\",\n    vars={\n        \"user\": \"app\",\n        \"workdir\": \"/opt/apps/myapp\",\n        \"exec_start\": \"/opt/apps/myapp/start.sh\"\n    }\n)\n\n# Reload systemd daemon when service file changes\n# (systemd-specific - requires custom Exec resource)\n\n# Manage service\nService(\"myapp\", running=True, enabled=True, restart_on=[service_file])\n</code></pre>"},{"location":"resources/service/#service-with-environment-variables","title":"Service with Environment Variables","text":"<p>Template: <code>myapp-env.service.j2</code></p> <pre><code>[Unit]\nDescription=My Application\nAfter=network.target\n\n[Service]\nType=simple\nUser={{ user }}\nWorkingDirectory={{ workdir }}\nEnvironment=\"PORT={{ port }}\"\nEnvironment=\"LOG_LEVEL={{ log_level }}\"\nExecStart={{ exec_start }}\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Cook configuration:</p> <pre><code>File(\n    \"/etc/systemd/system/myapp.service\",\n    template=\"./myapp-env.service.j2\",\n    vars={\n        \"user\": \"app\",\n        \"workdir\": \"/opt/apps/myapp\",\n        \"exec_start\": \"/opt/apps/myapp/app\",\n        \"port\": 3000,\n        \"log_level\": \"info\"\n    }\n)\n\nService(\"myapp\", running=True, enabled=True)\n</code></pre>"},{"location":"resources/service/#idempotency","title":"Idempotency","text":"<p>Service resources are idempotent. Running the same configuration multiple times produces the same result.</p> <pre><code>Service(\"nginx\", running=True, enabled=True)\n# First run: Starts and enables nginx\n# Second run: Detects nginx already running and enabled, no changes\n</code></pre> <p>Service state changes are detected:</p> <pre><code>Service(\"nginx\", running=True)\n# If nginx is stopped, Cook starts it\n# If nginx is running, Cook makes no changes\n</code></pre>"},{"location":"resources/service/#platform-specific-behavior","title":"Platform-Specific Behavior","text":""},{"location":"resources/service/#linux-systemd","title":"Linux (systemd)","text":"<pre><code>Service(\"nginx\", running=True, enabled=True)\n</code></pre> <p>Equivalent to:</p> <pre><code>systemctl start nginx\nsystemctl enable nginx\n</code></pre> <p>Check status:</p> <pre><code>systemctl is-active nginx\nsystemctl is-enabled nginx\n</code></pre> <p>Reload:</p> <pre><code>systemctl reload nginx\n</code></pre> <p>Restart:</p> <pre><code>systemctl restart nginx\n</code></pre>"},{"location":"resources/service/#macos-launchctl","title":"macOS (launchctl)","text":"<pre><code>Service(\"nginx\", running=True)\n</code></pre> <p>Equivalent to:</p> <pre><code>launchctl start nginx\n</code></pre> <p>Note: macOS service management differs from Linux. Services are defined in plist files in <code>/Library/LaunchDaemons/</code> or <code>~/Library/LaunchAgents/</code>.</p>"},{"location":"resources/service/#common-patterns","title":"Common Patterns","text":""},{"location":"resources/service/#web-application-stack","title":"Web Application Stack","text":"<pre><code>from cook import Package, File, Service\n\n# Install packages\nPackage(\"nginx\")\nPackage(\"postgresql\")\n\n# Nginx configuration\nnginx_conf = File(\"/etc/nginx/nginx.conf\", source=\"./nginx.conf\")\n\n# Services\nService(\"postgresql\", running=True, enabled=True)\nService(\"nginx\", running=True, enabled=True, reload_on=[nginx_conf])\n</code></pre>"},{"location":"resources/service/#systemd-socket-activation","title":"Systemd Socket Activation","text":"<pre><code># Socket file\nFile(\n    \"/etc/systemd/system/myapp.socket\",\n    source=\"./myapp.socket\"\n)\n\n# Service file\nFile(\n    \"/etc/systemd/system/myapp.service\",\n    source=\"./myapp.service\"\n)\n\n# Manage socket (service starts on demand)\nService(\"myapp.socket\", running=True, enabled=True)\n</code></pre>"},{"location":"resources/service/#service-with-health-check","title":"Service with Health Check","text":"<pre><code>from cook import File, Service, Exec\n\n# Service files\napp_binary = File(\"/opt/apps/myapp/app\", source=\"./app\", mode=0o755)\n\n# Start service\nService(\"myapp\", running=True, enabled=True, restart_on=[app_binary])\n\n# Health check (verify service is responding)\nExec(\n    \"health-check\",\n    command=\"curl -f http://localhost:3000/health || exit 1\",\n    retry=3\n)\n</code></pre>"},{"location":"resources/service/#security-considerations","title":"Security Considerations","text":""},{"location":"resources/service/#service-user","title":"Service User","text":"<p>Run services with dedicated users, not root:</p> <pre><code>[Service]\nUser=app\nGroup=app\n</code></pre>"},{"location":"resources/service/#service-hardening","title":"Service Hardening","text":"<p>Use systemd hardening features:</p> <pre><code>[Service]\nNoNewPrivileges=true\nPrivateTmp=true\nProtectSystem=strict\nProtectHome=true\nReadWritePaths=/opt/apps/myapp/data\n</code></pre>"},{"location":"resources/service/#service-restart-limits","title":"Service Restart Limits","text":"<p>Prevent restart loops:</p> <pre><code>[Service]\nRestart=on-failure\nRestartSec=5s\nStartLimitBurst=3\nStartLimitIntervalSec=60s\n</code></pre>"},{"location":"resources/service/#troubleshooting","title":"Troubleshooting","text":""},{"location":"resources/service/#service-fails-to-start","title":"Service Fails to Start","text":"<p>Check service status:</p> <pre><code>systemctl status nginx\njournalctl -u nginx -n 50\n</code></pre> <p>Verify service file syntax:</p> <pre><code>systemd-analyze verify /etc/systemd/system/myapp.service\n</code></pre>"},{"location":"resources/service/#service-not-enabled","title":"Service Not Enabled","text":"<p>Ensure service file is installed before enabling:</p> <pre><code>service_file = File(\"/etc/systemd/system/myapp.service\", source=\"./myapp.service\")\n\n# systemd requires daemon-reload after service file changes\n# This can be done with Exec resource\n\nService(\"myapp\", enabled=True)\n</code></pre>"},{"location":"resources/service/#reload-not-working","title":"Reload Not Working","text":"<p>Not all services support reload. Use restart instead:</p> <pre><code>Service(\"myapp\", running=True, restart_on=[config_file])\n</code></pre>"},{"location":"resources/service/#limitations","title":"Limitations","text":""},{"location":"resources/service/#macos-launchctl_1","title":"macOS launchctl","text":"<ul> <li>No direct enable/disable support (services are enabled by plist file presence)</li> <li>No reload operation (use restart)</li> <li>Service names follow reverse-domain format (e.g., <code>com.example.myapp</code>)</li> </ul>"},{"location":"resources/service/#service-dependencies","title":"Service Dependencies","text":"<p>Cook does not automatically handle systemd dependencies (After, Requires, Wants). Define these in the service unit file.</p>"},{"location":"resources/service/#api-reference","title":"API Reference","text":"<p>See cook/resources/service.py for complete source code and implementation details.</p>"}]}